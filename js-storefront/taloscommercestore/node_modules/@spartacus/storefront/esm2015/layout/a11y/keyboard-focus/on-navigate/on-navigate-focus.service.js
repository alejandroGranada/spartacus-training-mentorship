import { DOCUMENT } from '@angular/common';
import { Inject, Injectable } from '@angular/core';
import { NavigationStart, Router } from '@angular/router';
import { filter, take } from 'rxjs/operators';
import { BreakpointService } from '../../../../layout/breakpoint/breakpoint.service';
import { KeyboardFocusConfig } from '../config';
import * as i0 from "@angular/core";
import * as i1 from "../config/keyboard-focus.config";
import * as i2 from "@angular/router";
import * as i3 from "@angular/common";
import * as i4 from "../../../breakpoint/breakpoint.service";
/**
 * Shared service for keyboard focus features called when the browser navigates.
 */
export class OnNavigateFocusService {
    constructor(config, router, document, breakpointService) {
        this.config = config;
        this.router = router;
        this.document = document;
        this.breakpointService = breakpointService;
    }
    /**
     * Reads configuration and enables features based on flags set.
     */
    initializeWithConfig() {
        var _a, _b, _c, _d;
        if ((_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.keyboardFocus) === null || _b === void 0 ? void 0 : _b.enableResetFocusOnNavigate) {
            this.setResetFocusOnNavigate(this.config.keyboardFocus.enableResetFocusOnNavigate);
        }
        if ((_d = (_c = this.config) === null || _c === void 0 ? void 0 : _c.keyboardFocus) === null || _d === void 0 ? void 0 : _d.enableResetViewOnNavigate) {
            this.setResetViewOnNavigate(this.config.keyboardFocus.enableResetViewOnNavigate);
        }
    }
    /**
     * Resets focus back to root element `<cx-storefront>` in the DOM tree when a navigation is started.
     * @param enable Enable or disable this feature. Set this to an array of BREAKPOINTS to enable for specified screen widths.
     */
    setResetFocusOnNavigate(enable) {
        var _a;
        (_a = this.resetFocusOnNavigate) === null || _a === void 0 ? void 0 : _a.unsubscribe();
        if (enable) {
            this.resetFocusOnNavigate = this.router.events
                .pipe(filter((event) => event instanceof NavigationStart))
                .subscribe(() => {
                if (Array.isArray(enable)) {
                    this.breakpointService.breakpoint$
                        .pipe(take(1))
                        .subscribe((breakpoint) => {
                        if (enable.includes(breakpoint)) {
                            this.getStorefrontElement().focus();
                        }
                    });
                }
                else if (typeof enable === 'boolean') {
                    this.getStorefrontElement().focus();
                }
            });
        }
    }
    /**
     * Resets view back to root element `<cx-storefront>` in the DOM tree when a navigation is started.
     * @param enable Enable or disable this feature. Set this to an array of BREAKPOINTS to enable for specified screen widths.
     */
    setResetViewOnNavigate(enable) {
        var _a;
        (_a = this.resetViewOnNavigate) === null || _a === void 0 ? void 0 : _a.unsubscribe();
        if (enable) {
            this.resetViewOnNavigate = this.router.events
                .pipe(filter((event) => event instanceof NavigationStart))
                .subscribe(() => {
                if (Array.isArray(enable)) {
                    this.breakpointService.breakpoint$
                        .pipe(take(1))
                        .subscribe((breakpoint) => {
                        if (enable.includes(breakpoint)) {
                            this.getStorefrontElement().scrollIntoView();
                        }
                    });
                }
                else if (typeof enable === 'boolean') {
                    this.getStorefrontElement().scrollIntoView();
                }
            });
        }
    }
    /**
     * Gets the root element `<cx-storefront>`.
     */
    getStorefrontElement() {
        return this.document.getElementsByTagName('cx-storefront')[0];
    }
}
OnNavigateFocusService.ɵprov = i0.ɵɵdefineInjectable({ factory: function OnNavigateFocusService_Factory() { return new OnNavigateFocusService(i0.ɵɵinject(i1.KeyboardFocusConfig), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.DOCUMENT), i0.ɵɵinject(i4.BreakpointService)); }, token: OnNavigateFocusService, providedIn: "root" });
OnNavigateFocusService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
OnNavigateFocusService.ctorParameters = () => [
    { type: KeyboardFocusConfig },
    { type: Router },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: BreakpointService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib24tbmF2aWdhdGUtZm9jdXMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9QYXRyeWsvRGVza3RvcC9zcGFydGFjdXMvcHJvamVjdHMvc3RvcmVmcm9udGxpYi9zcmMvIiwic291cmNlcyI6WyJsYXlvdXQvYTExeS9rZXlib2FyZC1mb2N1cy9vbi1uYXZpZ2F0ZS9vbi1uYXZpZ2F0ZS1mb2N1cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTFELE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDckYsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sV0FBVyxDQUFDOzs7Ozs7QUFFaEQ7O0dBRUc7QUFJSCxNQUFNLE9BQU8sc0JBQXNCO0lBSWpDLFlBQ1ksTUFBMkIsRUFDM0IsTUFBYyxFQUNJLFFBQWEsRUFDL0IsaUJBQW9DO1FBSHBDLFdBQU0sR0FBTixNQUFNLENBQXFCO1FBQzNCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDSSxhQUFRLEdBQVIsUUFBUSxDQUFLO1FBQy9CLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7SUFDN0MsQ0FBQztJQUVKOztPQUVHO0lBQ0gsb0JBQW9COztRQUNsQixnQkFBSSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxhQUFhLDBDQUFFLDBCQUEwQixFQUFFO1lBQzFELElBQUksQ0FBQyx1QkFBdUIsQ0FDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQ3JELENBQUM7U0FDSDtRQUVELGdCQUFJLElBQUksQ0FBQyxNQUFNLDBDQUFFLGFBQWEsMENBQUUseUJBQXlCLEVBQUU7WUFDekQsSUFBSSxDQUFDLHNCQUFzQixDQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyx5QkFBeUIsQ0FDcEQsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNILHVCQUF1QixDQUFDLE1BQThCOztRQUNwRCxNQUFBLElBQUksQ0FBQyxvQkFBb0IsMENBQUUsV0FBVyxHQUFHO1FBRXpDLElBQUksTUFBTSxFQUFFO1lBQ1YsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTtpQkFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxZQUFZLGVBQWUsQ0FBQyxDQUFDO2lCQUN6RCxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNkLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDekIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVc7eUJBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ2IsU0FBUyxDQUFDLENBQUMsVUFBc0IsRUFBRSxFQUFFO3dCQUNwQyxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7NEJBQy9CLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO3lCQUNyQztvQkFDSCxDQUFDLENBQUMsQ0FBQztpQkFDTjtxQkFBTSxJQUFJLE9BQU8sTUFBTSxLQUFLLFNBQVMsRUFBRTtvQkFDdEMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7aUJBQ3JDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7U0FDTjtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxzQkFBc0IsQ0FBQyxNQUE4Qjs7UUFDbkQsTUFBQSxJQUFJLENBQUMsbUJBQW1CLDBDQUFFLFdBQVcsR0FBRztRQUV4QyxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07aUJBQzFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssWUFBWSxlQUFlLENBQUMsQ0FBQztpQkFDekQsU0FBUyxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7b0JBQ3pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXO3lCQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3lCQUNiLFNBQVMsQ0FBQyxDQUFDLFVBQXNCLEVBQUUsRUFBRTt3QkFDcEMsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFOzRCQUMvQixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQzt5QkFDOUM7b0JBQ0gsQ0FBQyxDQUFDLENBQUM7aUJBQ047cUJBQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxTQUFTLEVBQUU7b0JBQ3RDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLGNBQWMsRUFBRSxDQUFDO2lCQUM5QztZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ047SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxvQkFBb0I7UUFDMUIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7Ozs7WUF4RkYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7WUFQUSxtQkFBbUI7WUFMRixNQUFNOzRDQW9CM0IsTUFBTSxTQUFDLFFBQVE7WUFoQlgsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uU3RhcnQsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJSRUFLUE9JTlQgfSBmcm9tICcuLi8uLi8uLi9jb25maWcnO1xuaW1wb3J0IHsgQnJlYWtwb2ludFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9sYXlvdXQvYnJlYWtwb2ludC9icmVha3BvaW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgS2V5Ym9hcmRGb2N1c0NvbmZpZyB9IGZyb20gJy4uL2NvbmZpZyc7XG5cbi8qKlxuICogU2hhcmVkIHNlcnZpY2UgZm9yIGtleWJvYXJkIGZvY3VzIGZlYXR1cmVzIGNhbGxlZCB3aGVuIHRoZSBicm93c2VyIG5hdmlnYXRlcy5cbiAqL1xuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIE9uTmF2aWdhdGVGb2N1c1NlcnZpY2Uge1xuICBwcm90ZWN0ZWQgcmVzZXRGb2N1c09uTmF2aWdhdGU6IFN1YnNjcmlwdGlvbjtcbiAgcHJvdGVjdGVkIHJlc2V0Vmlld09uTmF2aWdhdGU6IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlnOiBLZXlib2FyZEZvY3VzQ29uZmlnLFxuICAgIHByb3RlY3RlZCByb3V0ZXI6IFJvdXRlcixcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcm90ZWN0ZWQgZG9jdW1lbnQ6IGFueSxcbiAgICBwcm90ZWN0ZWQgYnJlYWtwb2ludFNlcnZpY2U6IEJyZWFrcG9pbnRTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICogUmVhZHMgY29uZmlndXJhdGlvbiBhbmQgZW5hYmxlcyBmZWF0dXJlcyBiYXNlZCBvbiBmbGFncyBzZXQuXG4gICAqL1xuICBpbml0aWFsaXplV2l0aENvbmZpZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWc/LmtleWJvYXJkRm9jdXM/LmVuYWJsZVJlc2V0Rm9jdXNPbk5hdmlnYXRlKSB7XG4gICAgICB0aGlzLnNldFJlc2V0Rm9jdXNPbk5hdmlnYXRlKFxuICAgICAgICB0aGlzLmNvbmZpZy5rZXlib2FyZEZvY3VzLmVuYWJsZVJlc2V0Rm9jdXNPbk5hdmlnYXRlXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZz8ua2V5Ym9hcmRGb2N1cz8uZW5hYmxlUmVzZXRWaWV3T25OYXZpZ2F0ZSkge1xuICAgICAgdGhpcy5zZXRSZXNldFZpZXdPbk5hdmlnYXRlKFxuICAgICAgICB0aGlzLmNvbmZpZy5rZXlib2FyZEZvY3VzLmVuYWJsZVJlc2V0Vmlld09uTmF2aWdhdGVcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyBmb2N1cyBiYWNrIHRvIHJvb3QgZWxlbWVudCBgPGN4LXN0b3JlZnJvbnQ+YCBpbiB0aGUgRE9NIHRyZWUgd2hlbiBhIG5hdmlnYXRpb24gaXMgc3RhcnRlZC5cbiAgICogQHBhcmFtIGVuYWJsZSBFbmFibGUgb3IgZGlzYWJsZSB0aGlzIGZlYXR1cmUuIFNldCB0aGlzIHRvIGFuIGFycmF5IG9mIEJSRUFLUE9JTlRTIHRvIGVuYWJsZSBmb3Igc3BlY2lmaWVkIHNjcmVlbiB3aWR0aHMuXG4gICAqL1xuICBzZXRSZXNldEZvY3VzT25OYXZpZ2F0ZShlbmFibGU6IGJvb2xlYW4gfCBCUkVBS1BPSU5UW10pOiB2b2lkIHtcbiAgICB0aGlzLnJlc2V0Rm9jdXNPbk5hdmlnYXRlPy51bnN1YnNjcmliZSgpO1xuXG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgdGhpcy5yZXNldEZvY3VzT25OYXZpZ2F0ZSA9IHRoaXMucm91dGVyLmV2ZW50c1xuICAgICAgICAucGlwZShmaWx0ZXIoKGV2ZW50KSA9PiBldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25TdGFydCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGVuYWJsZSkpIHtcbiAgICAgICAgICAgIHRoaXMuYnJlYWtwb2ludFNlcnZpY2UuYnJlYWtwb2ludCRcbiAgICAgICAgICAgICAgLnBpcGUodGFrZSgxKSlcbiAgICAgICAgICAgICAgLnN1YnNjcmliZSgoYnJlYWtwb2ludDogQlJFQUtQT0lOVCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbmFibGUuaW5jbHVkZXMoYnJlYWtwb2ludCkpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0U3RvcmVmcm9udEVsZW1lbnQoKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZW5hYmxlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0U3RvcmVmcm9udEVsZW1lbnQoKS5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyB2aWV3IGJhY2sgdG8gcm9vdCBlbGVtZW50IGA8Y3gtc3RvcmVmcm9udD5gIGluIHRoZSBET00gdHJlZSB3aGVuIGEgbmF2aWdhdGlvbiBpcyBzdGFydGVkLlxuICAgKiBAcGFyYW0gZW5hYmxlIEVuYWJsZSBvciBkaXNhYmxlIHRoaXMgZmVhdHVyZS4gU2V0IHRoaXMgdG8gYW4gYXJyYXkgb2YgQlJFQUtQT0lOVFMgdG8gZW5hYmxlIGZvciBzcGVjaWZpZWQgc2NyZWVuIHdpZHRocy5cbiAgICovXG4gIHNldFJlc2V0Vmlld09uTmF2aWdhdGUoZW5hYmxlOiBib29sZWFuIHwgQlJFQUtQT0lOVFtdKTogdm9pZCB7XG4gICAgdGhpcy5yZXNldFZpZXdPbk5hdmlnYXRlPy51bnN1YnNjcmliZSgpO1xuXG4gICAgaWYgKGVuYWJsZSkge1xuICAgICAgdGhpcy5yZXNldFZpZXdPbk5hdmlnYXRlID0gdGhpcy5yb3V0ZXIuZXZlbnRzXG4gICAgICAgIC5waXBlKGZpbHRlcigoZXZlbnQpID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvblN0YXJ0KSlcbiAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZW5hYmxlKSkge1xuICAgICAgICAgICAgdGhpcy5icmVha3BvaW50U2VydmljZS5icmVha3BvaW50JFxuICAgICAgICAgICAgICAucGlwZSh0YWtlKDEpKVxuICAgICAgICAgICAgICAuc3Vic2NyaWJlKChicmVha3BvaW50OiBCUkVBS1BPSU5UKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVuYWJsZS5pbmNsdWRlcyhicmVha3BvaW50KSkge1xuICAgICAgICAgICAgICAgICAgdGhpcy5nZXRTdG9yZWZyb250RWxlbWVudCgpLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbmFibGUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgdGhpcy5nZXRTdG9yZWZyb250RWxlbWVudCgpLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgcm9vdCBlbGVtZW50IGA8Y3gtc3RvcmVmcm9udD5gLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXRTdG9yZWZyb250RWxlbWVudCgpOiBIVE1MRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2N4LXN0b3JlZnJvbnQnKVswXTtcbiAgfVxufVxuIl19
import { Component, Input, Optional, } from '@angular/core';
import { PromotionLocation, } from '@spartacus/core';
import { PromotionService } from '../../../../shared/services/promotion/promotion.service';
import { ICON_TYPE } from '../../../misc/icon/icon.model';
import { CartOutlets } from '../../cart-outlets.model';
import { CartItemContextSource } from './model/cart-item-context-source.model';
import { CartItemContext } from './model/cart-item-context.model';
export class CartItemComponent {
    constructor(promotionService, cartItemContextSource) {
        this.promotionService = promotionService;
        this.cartItemContextSource = cartItemContextSource;
        this.compact = false;
        this.readonly = false;
        this.promotionLocation = PromotionLocation.ActiveCart;
        // TODO: evaluate whether this is generic enough
        this.options = {
            isSaveForLater: false,
            optionalBtn: null,
        };
        this.iconTypes = ICON_TYPE;
        this.CartOutlets = CartOutlets;
    }
    ngOnInit() {
        this.appliedProductPromotions$ = this.promotionService.getProductPromotionForEntry(this.item, this.promotionLocation);
    }
    ngOnChanges(changes) {
        var _a, _b, _c, _d, _e, _f, _g;
        if (changes === null || changes === void 0 ? void 0 : changes.compact) {
            (_a = this.cartItemContextSource) === null || _a === void 0 ? void 0 : _a.compact$.next(this.compact);
        }
        if (changes === null || changes === void 0 ? void 0 : changes.readonly) {
            (_b = this.cartItemContextSource) === null || _b === void 0 ? void 0 : _b.readonly$.next(this.readonly);
        }
        if (changes === null || changes === void 0 ? void 0 : changes.item) {
            (_c = this.cartItemContextSource) === null || _c === void 0 ? void 0 : _c.item$.next(this.item);
        }
        if (changes === null || changes === void 0 ? void 0 : changes.quantityControl) {
            (_d = this.cartItemContextSource) === null || _d === void 0 ? void 0 : _d.quantityControl$.next(this.quantityControl);
        }
        if (changes === null || changes === void 0 ? void 0 : changes.promotionLocation) {
            (_e = this.cartItemContextSource) === null || _e === void 0 ? void 0 : _e.promotionLocation$.next(this.promotionLocation);
            (_f = this.cartItemContextSource) === null || _f === void 0 ? void 0 : _f.location$.next(this.promotionLocation);
        }
        if (changes === null || changes === void 0 ? void 0 : changes.options) {
            (_g = this.cartItemContextSource) === null || _g === void 0 ? void 0 : _g.options$.next(this.options);
        }
    }
    isProductOutOfStock(product) {
        // TODO Move stocklevelstatuses across the app to an enum
        return (product &&
            product.stock &&
            product.stock.stockLevelStatus === 'outOfStock');
    }
    removeItem() {
        this.quantityControl.setValue(0);
        this.quantityControl.markAsDirty();
    }
}
CartItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'cx-cart-item',
                template: "<!-- Item Start Outlet -->\n<ng-template [cxOutlet]=\"CartOutlets.ITEM\">\n  <div [ngClass]=\"compact ? 'cx-compact row' : 'row'\">\n    <!-- Item Image -->\n    <div class=\"col-2 cx-image-container\">\n      <a\n        [routerLink]=\"{ cxRoute: 'product', params: item.product } | cxUrl\"\n        cxModal=\"dismiss\"\n        tabindex=\"-1\"\n      >\n        <cx-media\n          [container]=\"item.product.images?.PRIMARY\"\n          format=\"cartIcon\"\n        ></cx-media>\n      </a>\n    </div>\n    <!-- Item Information -->\n    <div class=\"cx-info col-10\">\n      <div class=\"cx-info-container row\">\n        <!-- Item Description -->\n        <div [ngClass]=\"compact ? '' : ' col-md-3 col-lg-3 col-xl-5'\">\n          <div *ngIf=\"item.product.name\" class=\"cx-name\">\n            <a\n              class=\"cx-link\"\n              [routerLink]=\"\n                { cxRoute: 'product', params: item.product } | cxUrl\n              \"\n              cxModal=\"dismiss\"\n              >{{ item.product.name }}</a\n            >\n          </div>\n          <div *ngIf=\"item.product.code\" class=\"cx-code\">\n            {{ 'cartItems.id' | cxTranslate }} {{ item.product.code }}\n          </div>\n\n          <!-- Item Details Outlet -->\n          <ng-template [cxOutlet]=\"CartOutlets.ITEM_DETAILS\"> </ng-template>\n\n          <!-- Variants -->\n          <ng-container *ngIf=\"item.product.baseOptions?.length\">\n            <div\n              *ngFor=\"\n                let variant of item.product.baseOptions[0]?.selected\n                  ?.variantOptionQualifiers\n              \"\n              class=\"cx-property\"\n            >\n              <div class=\"cx-label\" *ngIf=\"variant.name && variant.value\">\n                {{ variant.name }}: {{ variant.value }}\n              </div>\n            </div>\n          </ng-container>\n        </div>\n        <!-- Item Price -->\n        <div\n          *ngIf=\"item.basePrice\"\n          class=\"cx-price\"\n          [ngClass]=\"compact ? '' : ' col-md-3 col-lg-3 col-xl-2'\"\n        >\n          <div\n            class=\"cx-label\"\n            [ngClass]=\"compact ? '' : ' d-block d-md-none d-lg-none d-xl-none'\"\n          >\n            {{ 'cartItems.itemPrice' | cxTranslate }}\n          </div>\n          <div *ngIf=\"item.basePrice\" class=\"cx-value\">\n            {{ item.basePrice?.formattedValue }}\n          </div>\n        </div>\n        <!-- Item Quantity -->\n        <div class=\"cx-quantity\" [ngClass]=\"compact ? '' : ' col-3'\">\n          <div\n            class=\"cx-label\"\n            [ngClass]=\"compact ? '' : ' d-block d-md-none d-lg-none d-xl-none'\"\n            placement=\"left\"\n            title=\"{{ 'cartItems.quantityTitle' | cxTranslate }}\"\n          >\n            {{ 'cartItems.quantity' | cxTranslate }}\n          </div>\n          <div class=\"cx-value\">\n            <cx-item-counter\n              [control]=\"quantityControl\"\n              [readonly]=\"\n                !item.updateable || readonly || options.isSaveForLater\n              \"\n              [max]=\"item.product.stock?.stockLevel || 1000\"\n              [allowZero]=\"true\"\n            >\n            </cx-item-counter>\n          </div>\n        </div>\n        <!-- Total -->\n        <ng-container *ngIf=\"options.isSaveForLater; else total\">\n          <div\n            class=\"cx-total\"\n            [ngClass]=\"compact ? '' : ' col-md-3 col-lg-3 col-xl-2'\"\n          >\n            <div\n              class=\"cx-label\"\n              [ngClass]=\"\n                compact ? '' : ' d-block d-md-none d-lg-none d-xl-none'\n              \"\n            >\n              {{ 'saveForLaterItems.stock' | cxTranslate }}\n            </div>\n            <div\n              *ngIf=\"item.product?.stock?.stockLevel >= 0; else forceInstock\"\n              class=\"cx-value\"\n            >\n              {{ item.product.stock.stockLevel }}\n            </div>\n            <ng-template #forceInstock>\n              <div class=\"cx-value\">\n                {{ 'saveForLaterItems.forceInStock' | cxTranslate }}\n              </div>\n            </ng-template>\n          </div>\n        </ng-container>\n      </div>\n      <!-- Availability -->\n      <div\n        *ngIf=\"isProductOutOfStock(item.product)\"\n        class=\"cx-availability col-12\"\n      >\n        {{ 'addToCart.outOfStock' | cxTranslate }}\n      </div>\n\n      <!-- Item Bundle Details Outlet -->\n      <ng-template [cxOutlet]=\"CartOutlets.ITEM_BUNDLE_DETAILS\"> </ng-template>\n\n      <!-- Promotion -->\n\n      <ng-container\n        *ngIf=\"appliedProductPromotions$ | async as appliedProductPromotions\"\n      >\n        <cx-promotions [promotions]=\"appliedProductPromotions\"></cx-promotions>\n      </ng-container>\n\n      <!-- Actions -->\n      <div\n        *ngIf=\"(!readonly || options.isSaveForLater) && item.updateable\"\n        class=\"cx-actions col-12\"\n      >\n        <ng-container *ngIf=\"!isProductOutOfStock(item.product)\">\n          <ng-container\n            *ngTemplateOutlet=\"\n              options.optionalBtn;\n              context: {\n                $implicit: { loading: quantityControl.disabled, item: item }\n              }\n            \"\n          ></ng-container>\n        </ng-container>\n\n        <div class=\"col-md-3 cx-remove-btn\">\n          <button\n            class=\"link cx-action-link\"\n            [disabled]=\"quantityControl.disabled\"\n            (click)=\"removeItem()\"\n          >\n            {{ 'common.remove' | cxTranslate }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <ng-template #total>\n    <div\n      *ngIf=\"item.totalPrice\"\n      class=\"cx-total\"\n      [ngClass]=\"compact ? '' : ' col-md-3 col-xl-2'\"\n    >\n      <div\n        class=\"cx-label\"\n        [ngClass]=\"compact ? '' : ' d-block d-md-none d-lg-none d-xl-none'\"\n      >\n        {{ 'cartItems.total' | cxTranslate }}\n      </div>\n      <div class=\"cx-value\">{{ item.totalPrice.formattedValue }}</div>\n    </div>\n  </ng-template>\n</ng-template>\n",
                providers: [
                    CartItemContextSource,
                    { provide: CartItemContext, useExisting: CartItemContextSource },
                ]
            },] }
];
CartItemComponent.ctorParameters = () => [
    { type: PromotionService },
    { type: CartItemContextSource, decorators: [{ type: Optional }] }
];
CartItemComponent.propDecorators = {
    compact: [{ type: Input }],
    item: [{ type: Input }],
    readonly: [{ type: Input }],
    quantityControl: [{ type: Input }],
    promotionLocation: [{ type: Input }],
    options: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FydC1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9QYXRyeWsvRGVza3RvcC9zcGFydGFjdXMvcHJvamVjdHMvc3RvcmVmcm9udGxpYi9zcmMvIiwic291cmNlcyI6WyJjbXMtY29tcG9uZW50cy9jYXJ0L2NhcnQtc2hhcmVkL2NhcnQtaXRlbS9jYXJ0LWl0ZW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUdMLFFBQVEsR0FFVCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBRUwsaUJBQWlCLEdBRWxCLE1BQU0saUJBQWlCLENBQUM7QUFFekIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDM0YsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzFELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUE2QmxFLE1BQU0sT0FBTyxpQkFBaUI7SUE2QjVCLFlBQ1ksZ0JBQWtDLEVBQ3RCLHFCQUE2QztRQUR6RCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ3RCLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBd0I7UUE5QjVELFlBQU8sR0FBRyxLQUFLLENBQUM7UUFFaEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdqQixzQkFBaUIsR0FBc0IsaUJBQWlCLENBQUMsVUFBVSxDQUFDO1FBRTdFLGdEQUFnRDtRQUN2QyxZQUFPLEdBQTZCO1lBQzNDLGNBQWMsRUFBRSxLQUFLO1lBQ3JCLFdBQVcsRUFBRSxJQUFJO1NBQ2xCLENBQUM7UUFHRixjQUFTLEdBQUcsU0FBUyxDQUFDO1FBQ2IsZ0JBQVcsR0FBRyxXQUFXLENBQUM7SUFnQmhDLENBQUM7SUFFSixRQUFRO1FBQ04sSUFBSSxDQUFDLHlCQUF5QixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQywyQkFBMkIsQ0FDaEYsSUFBSSxDQUFDLElBQUksRUFDVCxJQUFJLENBQUMsaUJBQWlCLENBQ3ZCLENBQUM7SUFDSixDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXVCOztRQUNqQyxJQUFJLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxPQUFPLEVBQUU7WUFDcEIsTUFBQSxJQUFJLENBQUMscUJBQXFCLDBDQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtTQUN6RDtRQUNELElBQUksT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLFFBQVEsRUFBRTtZQUNyQixNQUFBLElBQUksQ0FBQyxxQkFBcUIsMENBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1NBQzNEO1FBQ0QsSUFBSSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsSUFBSSxFQUFFO1lBQ2pCLE1BQUEsSUFBSSxDQUFDLHFCQUFxQiwwQ0FBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7U0FDbkQ7UUFDRCxJQUFJLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxlQUFlLEVBQUU7WUFDNUIsTUFBQSxJQUFJLENBQUMscUJBQXFCLDBDQUFFLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO1NBQ3pFO1FBQ0QsSUFBSSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsaUJBQWlCLEVBQUU7WUFDOUIsTUFBQSxJQUFJLENBQUMscUJBQXFCLDBDQUFFLGtCQUFrQixDQUFDLElBQUksQ0FDakQsSUFBSSxDQUFDLGlCQUFpQixFQUN0QjtZQUNGLE1BQUEsSUFBSSxDQUFDLHFCQUFxQiwwQ0FBRSxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtTQUNwRTtRQUNELElBQUksT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLE9BQU8sRUFBRTtZQUNwQixNQUFBLElBQUksQ0FBQyxxQkFBcUIsMENBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1NBQ3pEO0lBQ0gsQ0FBQztJQUVELG1CQUFtQixDQUFDLE9BQVk7UUFDOUIseURBQXlEO1FBQ3pELE9BQU8sQ0FDTCxPQUFPO1lBQ1AsT0FBTyxDQUFDLEtBQUs7WUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixLQUFLLFlBQVksQ0FDaEQsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVO1FBQ1IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNyQyxDQUFDOzs7WUFyRkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxjQUFjO2dCQUN4QiwyaE1BQXlDO2dCQUN6QyxTQUFTLEVBQUU7b0JBQ1QscUJBQXFCO29CQUNyQixFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsV0FBVyxFQUFFLHFCQUFxQixFQUFFO2lCQUNqRTthQUNGOzs7WUFoQ1EsZ0JBQWdCO1lBR2hCLHFCQUFxQix1QkE2RHpCLFFBQVE7OztzQkE5QlYsS0FBSzttQkFDTCxLQUFLO3VCQUNMLEtBQUs7OEJBQ0wsS0FBSztnQ0FFTCxLQUFLO3NCQUdMLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3B0aW9uYWwsXG4gIFNpbXBsZUNoYW5nZXMsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge1xuICBPcmRlckVudHJ5LFxuICBQcm9tb3Rpb25Mb2NhdGlvbixcbiAgUHJvbW90aW9uUmVzdWx0LFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUHJvbW90aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9wcm9tb3Rpb24vcHJvbW90aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgSUNPTl9UWVBFIH0gZnJvbSAnLi4vLi4vLi4vbWlzYy9pY29uL2ljb24ubW9kZWwnO1xuaW1wb3J0IHsgQ2FydE91dGxldHMgfSBmcm9tICcuLi8uLi9jYXJ0LW91dGxldHMubW9kZWwnO1xuaW1wb3J0IHsgQ2FydEl0ZW1Db250ZXh0U291cmNlIH0gZnJvbSAnLi9tb2RlbC9jYXJ0LWl0ZW0tY29udGV4dC1zb3VyY2UubW9kZWwnO1xuaW1wb3J0IHsgQ2FydEl0ZW1Db250ZXh0IH0gZnJvbSAnLi9tb2RlbC9jYXJ0LWl0ZW0tY29udGV4dC5tb2RlbCc7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgc2luY2UgMy4wIC0gdXNlIGBPcmRlckVudHJ5YCBpbnN0ZWFkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSXRlbSB7XG4gIGVudHJ5TnVtYmVyPzogbnVtYmVyO1xuICBwcm9kdWN0PzogYW55O1xuICBxdWFudGl0eT86IGFueTtcbiAgYmFzZVByaWNlPzogYW55O1xuICB0b3RhbFByaWNlPzogYW55O1xuICB1cGRhdGVhYmxlPzogYm9vbGVhbjtcbiAgc3RhdHVzU3VtbWFyeUxpc3Q/OiBhbnlbXTtcbiAgY29uZmlndXJhdGlvbkluZm9zPzogYW55W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FydEl0ZW1Db21wb25lbnRPcHRpb25zIHtcbiAgaXNTYXZlRm9yTGF0ZXI/OiBib29sZWFuO1xuICBvcHRpb25hbEJ0bj86IGFueTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtY2FydC1pdGVtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NhcnQtaXRlbS5jb21wb25lbnQuaHRtbCcsXG4gIHByb3ZpZGVyczogW1xuICAgIENhcnRJdGVtQ29udGV4dFNvdXJjZSxcbiAgICB7IHByb3ZpZGU6IENhcnRJdGVtQ29udGV4dCwgdXNlRXhpc3Rpbmc6IENhcnRJdGVtQ29udGV4dFNvdXJjZSB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBDYXJ0SXRlbUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgY29tcGFjdCA9IGZhbHNlO1xuICBASW5wdXQoKSBpdGVtOiBPcmRlckVudHJ5O1xuICBASW5wdXQoKSByZWFkb25seSA9IGZhbHNlO1xuICBASW5wdXQoKSBxdWFudGl0eUNvbnRyb2w6IEZvcm1Db250cm9sO1xuXG4gIEBJbnB1dCgpIHByb21vdGlvbkxvY2F0aW9uOiBQcm9tb3Rpb25Mb2NhdGlvbiA9IFByb21vdGlvbkxvY2F0aW9uLkFjdGl2ZUNhcnQ7XG5cbiAgLy8gVE9ETzogZXZhbHVhdGUgd2hldGhlciB0aGlzIGlzIGdlbmVyaWMgZW5vdWdoXG4gIEBJbnB1dCgpIG9wdGlvbnM6IENhcnRJdGVtQ29tcG9uZW50T3B0aW9ucyA9IHtcbiAgICBpc1NhdmVGb3JMYXRlcjogZmFsc2UsXG4gICAgb3B0aW9uYWxCdG46IG51bGwsXG4gIH07XG5cbiAgYXBwbGllZFByb2R1Y3RQcm9tb3Rpb25zJDogT2JzZXJ2YWJsZTxQcm9tb3Rpb25SZXN1bHRbXT47XG4gIGljb25UeXBlcyA9IElDT05fVFlQRTtcbiAgcmVhZG9ubHkgQ2FydE91dGxldHMgPSBDYXJ0T3V0bGV0cztcblxuICAvLyBUT0RPKCMxMDk0Nik6IG1ha2UgQ2FydEl0ZW1Db250ZXh0U291cmNlIGEgcmVxdWlyZWQgZGVwZW5kZW5jeVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuaWZpZWQtc2lnbmF0dXJlc1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcm9tb3Rpb25TZXJ2aWNlOiBQcm9tb3Rpb25TZXJ2aWNlLFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvdW5pZmllZC1zaWduYXR1cmVzXG4gICAgY2FydEl0ZW1Db250ZXh0U291cmNlOiBDYXJ0SXRlbUNvbnRleHRTb3VyY2VcbiAgKTtcbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkIHNpbmNlIDMuMVxuICAgKi9cbiAgY29uc3RydWN0b3IocHJvbW90aW9uU2VydmljZTogUHJvbW90aW9uU2VydmljZSk7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBwcm9tb3Rpb25TZXJ2aWNlOiBQcm9tb3Rpb25TZXJ2aWNlLFxuICAgIEBPcHRpb25hbCgpIHByb3RlY3RlZCBjYXJ0SXRlbUNvbnRleHRTb3VyY2U/OiBDYXJ0SXRlbUNvbnRleHRTb3VyY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuYXBwbGllZFByb2R1Y3RQcm9tb3Rpb25zJCA9IHRoaXMucHJvbW90aW9uU2VydmljZS5nZXRQcm9kdWN0UHJvbW90aW9uRm9yRW50cnkoXG4gICAgICB0aGlzLml0ZW0sXG4gICAgICB0aGlzLnByb21vdGlvbkxvY2F0aW9uXG4gICAgKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM/OiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXM/LmNvbXBhY3QpIHtcbiAgICAgIHRoaXMuY2FydEl0ZW1Db250ZXh0U291cmNlPy5jb21wYWN0JC5uZXh0KHRoaXMuY29tcGFjdCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzPy5yZWFkb25seSkge1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/LnJlYWRvbmx5JC5uZXh0KHRoaXMucmVhZG9ubHkpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlcz8uaXRlbSkge1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/Lml0ZW0kLm5leHQodGhpcy5pdGVtKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXM/LnF1YW50aXR5Q29udHJvbCkge1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/LnF1YW50aXR5Q29udHJvbCQubmV4dCh0aGlzLnF1YW50aXR5Q29udHJvbCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzPy5wcm9tb3Rpb25Mb2NhdGlvbikge1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/LnByb21vdGlvbkxvY2F0aW9uJC5uZXh0KFxuICAgICAgICB0aGlzLnByb21vdGlvbkxvY2F0aW9uXG4gICAgICApO1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/LmxvY2F0aW9uJC5uZXh0KHRoaXMucHJvbW90aW9uTG9jYXRpb24pO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlcz8ub3B0aW9ucykge1xuICAgICAgdGhpcy5jYXJ0SXRlbUNvbnRleHRTb3VyY2U/Lm9wdGlvbnMkLm5leHQodGhpcy5vcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBpc1Byb2R1Y3RPdXRPZlN0b2NrKHByb2R1Y3Q6IGFueSkge1xuICAgIC8vIFRPRE8gTW92ZSBzdG9ja2xldmVsc3RhdHVzZXMgYWNyb3NzIHRoZSBhcHAgdG8gYW4gZW51bVxuICAgIHJldHVybiAoXG4gICAgICBwcm9kdWN0ICYmXG4gICAgICBwcm9kdWN0LnN0b2NrICYmXG4gICAgICBwcm9kdWN0LnN0b2NrLnN0b2NrTGV2ZWxTdGF0dXMgPT09ICdvdXRPZlN0b2NrJ1xuICAgICk7XG4gIH1cblxuICByZW1vdmVJdGVtKCkge1xuICAgIHRoaXMucXVhbnRpdHlDb250cm9sLnNldFZhbHVlKDApO1xuICAgIHRoaXMucXVhbnRpdHlDb250cm9sLm1hcmtBc0RpcnR5KCk7XG4gIH1cbn1cbiJdfQ==
import { Injectable } from '@angular/core';
import { shareReplay } from 'rxjs/operators';
import { UnifiedInjector } from '../../lazy-loading/unified-injector';
import { SmartEditService } from '../../smart-edit/services/smart-edit.service';
import { getLastValueSync } from '../../util/rxjs/get-last-value-sync';
import { ComponentDecorator } from '../decorators/component-decorator';
import { SlotDecorator } from '../decorators/slot-decorator';
import * as i0 from "@angular/core";
import * as i1 from "../../smart-edit/services/smart-edit.service";
import * as i2 from "../../lazy-loading/unified-injector";
/**
 * Service that used to add dynamic attributes to CMS component
 * and slot elements.
 */
export class DynamicAttributeService {
    constructor(
    // TODO: remove this SmartEditService in 4.0
    smartEditService, unifiedInjector) {
        this.smartEditService = smartEditService;
        this.unifiedInjector = unifiedInjector;
        this.componentDecorators$ = this.unifiedInjector
            .getMulti(ComponentDecorator)
            .pipe(shareReplay(1));
        this.slotDecorators$ = this.unifiedInjector
            .getMulti(SlotDecorator)
            .pipe(shareReplay(1));
    }
    /**
     * @deprecated since 3.2, use functions addAttributesToComponent and addAttributesToSlot instead
     *
     * Add dynamic attributes to DOM.
     * @param element: slot or cms component element
     * @param renderer
     * @param cmsRenderingContext: an object containing properties in each cms item response data
     */
    addDynamicAttributes(element, renderer, cmsRenderingContext) {
        var _a, _b;
        const properties = ((_a = cmsRenderingContext.componentData) === null || _a === void 0 ? void 0 : _a.properties) || ((_b = cmsRenderingContext.slotData) === null || _b === void 0 ? void 0 : _b.properties);
        if (properties && this.smartEditService.isLaunchedInSmartEdit()) {
            // check each group of properties, e.g. smartedit
            Object.keys(properties).forEach((group) => {
                const name = 'data-' + group + '-';
                const groupProps = properties[group];
                // check each property in the group
                Object.keys(groupProps).forEach((propName) => {
                    const propValue = groupProps[propName];
                    if (propName === 'classes') {
                        const classes = propValue.split(' ');
                        classes.forEach((classItem) => {
                            element.classList.add(classItem);
                        });
                    }
                    else {
                        renderer.setAttribute(element, name +
                            propName
                                .split(/(?=[A-Z])/)
                                .join('-')
                                .toLowerCase(), propValue);
                    }
                });
            });
        }
    }
    /**
     * Add dynamic attributes to CMS component element
     * @param element: CMS component element
     * @param renderer
     * @param componentData: component data
     */
    addAttributesToComponent(element, renderer, componentData) {
        if (this.smartEditService.isLaunchedInSmartEdit()) {
            this.addDynamicAttributes(element, renderer, { componentData });
            return;
        }
        (getLastValueSync(this.componentDecorators$) || []).forEach((decorator) => decorator.decorate(element, renderer, componentData));
    }
    /**
     * Add dynamic attributes to CMS slot element
     * @param element: CMS slot element
     * @param renderer
     * @param slotData: slot data
     */
    addAttributesToSlot(element, renderer, slotData) {
        if (this.smartEditService.isLaunchedInSmartEdit()) {
            this.addDynamicAttributes(element, renderer, { slotData });
            return;
        }
        (getLastValueSync(this.slotDecorators$) || []).forEach((decorator) => decorator.decorate(element, renderer, slotData));
    }
}
DynamicAttributeService.ɵprov = i0.ɵɵdefineInjectable({ factory: function DynamicAttributeService_Factory() { return new DynamicAttributeService(i0.ɵɵinject(i1.SmartEditService), i0.ɵɵinject(i2.UnifiedInjector)); }, token: DynamicAttributeService, providedIn: "root" });
DynamicAttributeService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
DynamicAttributeService.ctorParameters = () => [
    { type: SmartEditService },
    { type: UnifiedInjector }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1hdHRyaWJ1dGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9QYXRyeWsvRGVza3RvcC9zcGFydGFjdXMvcHJvamVjdHMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy9jbXMvc2VydmljZXMvZHluYW1pYy1hdHRyaWJ1dGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDdEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDaEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDdkUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDOzs7O0FBSTdEOzs7R0FHRztBQUlILE1BQU0sT0FBTyx1QkFBdUI7SUFTbEM7SUFDRSw0Q0FBNEM7SUFDbEMsZ0JBQW1DLEVBQ25DLGVBQWlDO1FBRGpDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBbUI7UUFDbkMsb0JBQWUsR0FBZixlQUFlLENBQWtCO1FBWHJDLHlCQUFvQixHQUFHLElBQUksQ0FBQyxlQUFlO2FBQ2hELFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQzthQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFaEIsb0JBQWUsR0FBRyxJQUFJLENBQUMsZUFBZTthQUMzQyxRQUFRLENBQUMsYUFBYSxDQUFDO2FBQ3ZCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQU1yQixDQUFDO0lBRUo7Ozs7Ozs7T0FPRztJQUNILG9CQUFvQixDQUNsQixP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ICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHNoYXJlUmVwbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgVW5pZmllZEluamVjdG9yIH0gZnJvbSAnLi4vLi4vbGF6eS1sb2FkaW5nL3VuaWZpZWQtaW5qZWN0b3InO1xuaW1wb3J0IHsgU21hcnRFZGl0U2VydmljZSB9IGZyb20gJy4uLy4uL3NtYXJ0LWVkaXQvc2VydmljZXMvc21hcnQtZWRpdC5zZXJ2aWNlJztcbmltcG9ydCB7IGdldExhc3RWYWx1ZVN5bmMgfSBmcm9tICcuLi8uLi91dGlsL3J4anMvZ2V0LWxhc3QtdmFsdWUtc3luYyc7XG5pbXBvcnQgeyBDb21wb25lbnREZWNvcmF0b3IgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2NvbXBvbmVudC1kZWNvcmF0b3InO1xuaW1wb3J0IHsgU2xvdERlY29yYXRvciB9IGZyb20gJy4uL2RlY29yYXRvcnMvc2xvdC1kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ29udGVudFNsb3RDb21wb25lbnREYXRhIH0gZnJvbSAnLi4vbW9kZWwvY29udGVudC1zbG90LWNvbXBvbmVudC1kYXRhLm1vZGVsJztcbmltcG9ydCB7IENvbnRlbnRTbG90RGF0YSB9IGZyb20gJy4uL21vZGVsL2NvbnRlbnQtc2xvdC1kYXRhLm1vZGVsJztcblxuLyoqXG4gKiBTZXJ2aWNlIHRoYXQgdXNlZCB0byBhZGQgZHluYW1pYyBhdHRyaWJ1dGVzIHRvIENNUyBjb21wb25lbnRcbiAqIGFuZCBzbG90IGVsZW1lbnRzLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgRHluYW1pY0F0dHJpYnV0ZVNlcnZpY2Uge1xuICBwcml2YXRlIGNvbXBvbmVudERlY29yYXRvcnMkID0gdGhpcy51bmlmaWVkSW5qZWN0b3JcbiAgICAuZ2V0TXVsdGkoQ29tcG9uZW50RGVjb3JhdG9yKVxuICAgIC5waXBlKHNoYXJlUmVwbGF5KDEpKTtcblxuICBwcml2YXRlIHNsb3REZWNvcmF0b3JzJCA9IHRoaXMudW5pZmllZEluamVjdG9yXG4gICAgLmdldE11bHRpKFNsb3REZWNvcmF0b3IpXG4gICAgLnBpcGUoc2hhcmVSZXBsYXkoMSkpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIFNtYXJ0RWRpdFNlcnZpY2UgaW4gNC4wXG4gICAgcHJvdGVjdGVkIHNtYXJ0RWRpdFNlcnZpY2U/OiBTbWFydEVkaXRTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCB1bmlmaWVkSW5qZWN0b3I/OiBVbmlmaWVkSW5qZWN0b3JcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBzaW5jZSAzLjIsIHVzZSBmdW5jdGlvbnMgYWRkQXR0cmlidXRlc1RvQ29tcG9uZW50IGFuZCBhZGRBdHRyaWJ1dGVzVG9TbG90IGluc3RlYWRcbiAgICpcbiAgICogQWRkIGR5bmFtaWMgYXR0cmlidXRlcyB0byBET00uXG4gICAqIEBwYXJhbSBlbGVtZW50OiBzbG90IG9yIGNtcyBjb21wb25lbnQgZWxlbWVudFxuICAgKiBAcGFyYW0gcmVuZGVyZXJcbiAgICogQHBhcmFtIGNtc1JlbmRlcmluZ0NvbnRleHQ6IGFuIG9iamVjdCBjb250YWluaW5nIHByb3BlcnRpZXMgaW4gZWFjaCBjbXMgaXRlbSByZXNwb25zZSBkYXRhXG4gICAqL1xuICBhZGREeW5hbWljQXR0cmlidXRlcyhcbiAgICBlbGVtZW50OiBFbGVtZW50LFxuICAgIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgY21zUmVuZGVyaW5nQ29udGV4dDoge1xuICAgICAgY29tcG9uZW50RGF0YT86IENvbnRlbnRTbG90Q29tcG9uZW50RGF0YTtcbiAgICAgIHNsb3REYXRhPzogQ29udGVudFNsb3REYXRhO1xuICAgIH1cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9XG4gICAgICBjbXNSZW5kZXJpbmdDb250ZXh0LmNvbXBvbmVudERhdGE/LnByb3BlcnRpZXMgfHxcbiAgICAgIGNtc1JlbmRlcmluZ0NvbnRleHQuc2xvdERhdGE/LnByb3BlcnRpZXM7XG5cbiAgICBpZiAocHJvcGVydGllcyAmJiB0aGlzLnNtYXJ0RWRpdFNlcnZpY2UuaXNMYXVuY2hlZEluU21hcnRFZGl0KCkpIHtcbiAgICAgIC8vIGNoZWNrIGVhY2ggZ3JvdXAgb2YgcHJvcGVydGllcywgZS5nLiBzbWFydGVkaXRcbiAgICAgIE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLmZvckVhY2goKGdyb3VwKSA9PiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSAnZGF0YS0nICsgZ3JvdXAgKyAnLSc7XG4gICAgICAgIGNvbnN0IGdyb3VwUHJvcHMgPSBwcm9wZXJ0aWVzW2dyb3VwXTtcblxuICAgICAgICAvLyBjaGVjayBlYWNoIHByb3BlcnR5IGluIHRoZSBncm91cFxuICAgICAgICBPYmplY3Qua2V5cyhncm91cFByb3BzKS5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IGdyb3VwUHJvcHNbcHJvcE5hbWVdO1xuICAgICAgICAgIGlmIChwcm9wTmFtZSA9PT0gJ2NsYXNzZXMnKSB7XG4gICAgICAgICAgICBjb25zdCBjbGFzc2VzID0gcHJvcFZhbHVlLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICBjbGFzc2VzLmZvckVhY2goKGNsYXNzSXRlbSkgPT4ge1xuICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NJdGVtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZW5kZXJlci5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICAgIG5hbWUgK1xuICAgICAgICAgICAgICAgIHByb3BOYW1lXG4gICAgICAgICAgICAgICAgICAuc3BsaXQoLyg/PVtBLVpdKS8pXG4gICAgICAgICAgICAgICAgICAuam9pbignLScpXG4gICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgcHJvcFZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGR5bmFtaWMgYXR0cmlidXRlcyB0byBDTVMgY29tcG9uZW50IGVsZW1lbnRcbiAgICogQHBhcmFtIGVsZW1lbnQ6IENNUyBjb21wb25lbnQgZWxlbWVudFxuICAgKiBAcGFyYW0gcmVuZGVyZXJcbiAgICogQHBhcmFtIGNvbXBvbmVudERhdGE6IGNvbXBvbmVudCBkYXRhXG4gICAqL1xuICBhZGRBdHRyaWJ1dGVzVG9Db21wb25lbnQoXG4gICAgZWxlbWVudDogRWxlbWVudCxcbiAgICByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIGNvbXBvbmVudERhdGE/OiBDb250ZW50U2xvdENvbXBvbmVudERhdGFcbiAgKSB7XG4gICAgaWYgKHRoaXMuc21hcnRFZGl0U2VydmljZS5pc0xhdW5jaGVkSW5TbWFydEVkaXQoKSkge1xuICAgICAgdGhpcy5hZGREeW5hbWljQXR0cmlidXRlcyhlbGVtZW50LCByZW5kZXJlciwgeyBjb21wb25lbnREYXRhIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIChnZXRMYXN0VmFsdWVTeW5jKHRoaXMuY29tcG9uZW50RGVjb3JhdG9ycyQpIHx8IFtdKS5mb3JFYWNoKChkZWNvcmF0b3IpID0+XG4gICAgICBkZWNvcmF0b3IuZGVjb3JhdGUoZWxlbWVudCwgcmVuZGVyZXIsIGNvbXBvbmVudERhdGEpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgZHluYW1pYyBhdHRyaWJ1dGVzIHRvIENNUyBzbG90IGVsZW1lbnRcbiAgICogQHBhcmFtIGVsZW1lbnQ6IENNUyBzbG90IGVsZW1lbnRcbiAgICogQHBhcmFtIHJlbmRlcmVyXG4gICAqIEBwYXJhbSBzbG90RGF0YTogc2xvdCBkYXRhXG4gICAqL1xuICBhZGRBdHRyaWJ1dGVzVG9TbG90KFxuICAgIGVsZW1lbnQ6IEVsZW1lbnQsXG4gICAgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBzbG90RGF0YT86IENvbnRlbnRTbG90RGF0YVxuICApIHtcbiAgICBpZiAodGhpcy5zbWFydEVkaXRTZXJ2aWNlLmlzTGF1bmNoZWRJblNtYXJ0RWRpdCgpKSB7XG4gICAgICB0aGlzLmFkZER5bmFtaWNBdHRyaWJ1dGVzKGVsZW1lbnQsIHJlbmRlcmVyLCB7IHNsb3REYXRhIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIChnZXRMYXN0VmFsdWVTeW5jKHRoaXMuc2xvdERlY29yYXRvcnMkKSB8fCBbXSkuZm9yRWFjaCgoZGVjb3JhdG9yKSA9PlxuICAgICAgZGVjb3JhdG9yLmRlY29yYXRlKGVsZW1lbnQsIHJlbmRlcmVyLCBzbG90RGF0YSlcbiAgICApO1xuICB9XG59XG4iXX0=
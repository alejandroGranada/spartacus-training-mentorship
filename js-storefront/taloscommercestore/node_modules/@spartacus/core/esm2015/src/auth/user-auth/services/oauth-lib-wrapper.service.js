import { Inject, Injectable, PLATFORM_ID } from '@angular/core';
import { OAuthService } from 'angular-oauth2-oidc';
import { WindowRef } from '../../../window/window-ref';
import { AuthConfigService } from './auth-config.service';
import * as i0 from "@angular/core";
import * as i1 from "angular-oauth2-oidc";
import * as i2 from "./auth-config.service";
import * as i3 from "../../../window/window-ref";
/**
 * Wrapper service on the library OAuthService. Normalizes the lib API for services.
 * Use this service when you want to access low level OAuth library methods.
 */
export class OAuthLibWrapperService {
    // TODO: Remove platformId dependency in 4.0
    constructor(oAuthService, authConfigService, platformId, winRef) {
        this.oAuthService = oAuthService;
        this.authConfigService = authConfigService;
        this.platformId = platformId;
        this.winRef = winRef;
        this.initialize();
    }
    initialize() {
        var _a, _b, _c, _d;
        const isSSR = !this.winRef.isBrowser();
        this.oAuthService.configure(Object.assign({ tokenEndpoint: this.authConfigService.getTokenEndpoint(), loginUrl: this.authConfigService.getLoginUrl(), clientId: this.authConfigService.getClientId(), dummyClientSecret: this.authConfigService.getClientSecret(), revocationEndpoint: this.authConfigService.getRevokeEndpoint(), logoutUrl: this.authConfigService.getLogoutUrl(), userinfoEndpoint: this.authConfigService.getUserinfoEndpoint(), issuer: (_b = (_a = this.authConfigService.getOAuthLibConfig()) === null || _a === void 0 ? void 0 : _a.issuer) !== null && _b !== void 0 ? _b : this.authConfigService.getBaseUrl(), redirectUri: (_d = (_c = this.authConfigService.getOAuthLibConfig()) === null || _c === void 0 ? void 0 : _c.redirectUri) !== null && _d !== void 0 ? _d : (!isSSR
                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                    this.winRef.nativeWindow.location.origin
                : '') }, this.authConfigService.getOAuthLibConfig()));
    }
    /**
     * Authorize with ResourceOwnerPasswordFlow.
     *
     * @param userId
     * @param password
     *
     * @return token response from the lib
     */
    authorizeWithPasswordFlow(userId, password) {
        return this.oAuthService.fetchTokenUsingPasswordFlow(userId, password);
    }
    /**
     * Refresh access_token.
     */
    refreshToken() {
        this.oAuthService.refreshToken();
    }
    /**
     * Revoke access tokens and clear tokens in lib state.
     */
    revokeAndLogout() {
        return new Promise((resolve) => {
            this.oAuthService
                .revokeTokenAndLogout()
                .catch(() => {
                // when there would be some kind of error during revocation we can't do anything else, so at least we logout user.
                this.oAuthService.logOut();
            })
                .finally(() => {
                resolve();
            });
        });
    }
    /**
     * Clear tokens in library state (no revocation).
     */
    logout() {
        this.oAuthService.logOut();
    }
    /**
     * Returns Open Id token. Might be empty, when it was not requested with the `responseType` config.
     *
     * @return id token
     */
    getIdToken() {
        return this.oAuthService.getIdToken();
    }
    /**
     * Initialize Implicit Flow or Authorization Code flows with the redirect to OAuth login url.
     */
    initLoginFlow() {
        return this.oAuthService.initLoginFlow();
    }
    /**
     * Tries to login user based on `code` or `token` present in the url.
     */
    tryLogin() {
        return this.oAuthService.tryLogin({
            // We don't load discovery document, because it doesn't contain revoke endpoint information
            disableOAuth2StateCheck: true,
        });
    }
}
OAuthLibWrapperService.ɵprov = i0.ɵɵdefineInjectable({ factory: function OAuthLibWrapperService_Factory() { return new OAuthLibWrapperService(i0.ɵɵinject(i1.OAuthService), i0.ɵɵinject(i2.AuthConfigService), i0.ɵɵinject(i0.PLATFORM_ID), i0.ɵɵinject(i3.WindowRef)); }, token: OAuthLibWrapperService, providedIn: "root" });
OAuthLibWrapperService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
OAuthLibWrapperService.ctorParameters = () => [
    { type: OAuthService },
    { type: AuthConfigService },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: WindowRef }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2F1dGgtbGliLXdyYXBwZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9QYXRyeWsvRGVza3RvcC9zcGFydGFjdXMvcHJvamVjdHMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy9hdXRoL3VzZXItYXV0aC9zZXJ2aWNlcy9vYXV0aC1saWItd3JhcHBlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUUsWUFBWSxFQUFpQixNQUFNLHFCQUFxQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7QUFFMUQ7OztHQUdHO0FBSUgsTUFBTSxPQUFPLHNCQUFzQjtJQUNqQyw0Q0FBNEM7SUFDNUMsWUFDWSxZQUEwQixFQUMxQixpQkFBb0MsRUFDZixVQUFrQixFQUN2QyxNQUFpQjtRQUhqQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ2YsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUN2QyxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBRTNCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRVMsVUFBVTs7UUFDbEIsTUFBTSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxpQkFDekIsYUFBYSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsRUFBRSxFQUN4RCxRQUFRLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxFQUM5QyxRQUFRLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxFQUM5QyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxFQUFFLEVBQzNELGtCQUFrQixFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRSxFQUM5RCxTQUFTLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxFQUNoRCxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsbUJBQW1CLEVBQUUsRUFDOUQsTUFBTSxjQUNKLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRSwwQ0FBRSxNQUFNLG1DQUNsRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLEVBQ3JDLFdBQVcsY0FDVCxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsMENBQUUsV0FBVyxtQ0FDdkQsQ0FBQyxDQUFDLEtBQUs7Z0JBQ0wsQ0FBQyxDQUFDLG9FQUFvRTtvQkFDcEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFhLENBQUMsUUFBUSxDQUFDLE1BQU07Z0JBQzNDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFDTixJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsRUFDN0MsQ0FBQztJQUNMLENBQUM7SUFFRDs7Ozs7OztPQU9HO0lBQ0gseUJBQXlCLENBQ3ZCLE1BQWMsRUFDZCxRQUFnQjtRQUVoQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsMkJBQTJCLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRDs7T0FFRztJQUNILFlBQVk7UUFDVixJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWU7UUFDYixPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDN0IsSUFBSSxDQUFDLFlBQVk7aUJBQ2Qsb0JBQW9CLEVBQUU7aUJBQ3RCLEtBQUssQ0FBQyxHQUFHLEVBQUU7Z0JBQ1Ysa0hBQWtIO2dCQUNsSCxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzdCLENBQUMsQ0FBQztpQkFDRCxPQUFPLENBQUMsR0FBRyxFQUFFO2dCQUNaLE9BQU8sRUFBRSxDQUFDO1lBQ1osQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU07UUFDSixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsVUFBVTtRQUNSLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzNDLENBQUM7SUFFRDs7T0FFRztJQUNILFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO1lBQ2hDLDJGQUEyRjtZQUMzRix1QkFBdUIsRUFBRSxJQUFJO1NBQzlCLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7WUEzR0YsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7WUFWUSxZQUFZO1lBRVosaUJBQWlCO1lBY3FCLE1BQU0sdUJBQWhELE1BQU0sU0FBQyxXQUFXO1lBZmQsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9BdXRoU2VydmljZSwgVG9rZW5SZXNwb25zZSB9IGZyb20gJ2FuZ3VsYXItb2F1dGgyLW9pZGMnO1xuaW1wb3J0IHsgV2luZG93UmVmIH0gZnJvbSAnLi4vLi4vLi4vd2luZG93L3dpbmRvdy1yZWYnO1xuaW1wb3J0IHsgQXV0aENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuL2F1dGgtY29uZmlnLnNlcnZpY2UnO1xuXG4vKipcbiAqIFdyYXBwZXIgc2VydmljZSBvbiB0aGUgbGlicmFyeSBPQXV0aFNlcnZpY2UuIE5vcm1hbGl6ZXMgdGhlIGxpYiBBUEkgZm9yIHNlcnZpY2VzLlxuICogVXNlIHRoaXMgc2VydmljZSB3aGVuIHlvdSB3YW50IHRvIGFjY2VzcyBsb3cgbGV2ZWwgT0F1dGggbGlicmFyeSBtZXRob2RzLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgT0F1dGhMaWJXcmFwcGVyU2VydmljZSB7XG4gIC8vIFRPRE86IFJlbW92ZSBwbGF0Zm9ybUlkIGRlcGVuZGVuY3kgaW4gNC4wXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBvQXV0aFNlcnZpY2U6IE9BdXRoU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgYXV0aENvbmZpZ1NlcnZpY2U6IEF1dGhDb25maWdTZXJ2aWNlLFxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByb3RlY3RlZCBwbGF0Zm9ybUlkOiBPYmplY3QsXG4gICAgcHJvdGVjdGVkIHdpblJlZjogV2luZG93UmVmXG4gICkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGluaXRpYWxpemUoKSB7XG4gICAgY29uc3QgaXNTU1IgPSAhdGhpcy53aW5SZWYuaXNCcm93c2VyKCk7XG4gICAgdGhpcy5vQXV0aFNlcnZpY2UuY29uZmlndXJlKHtcbiAgICAgIHRva2VuRW5kcG9pbnQ6IHRoaXMuYXV0aENvbmZpZ1NlcnZpY2UuZ2V0VG9rZW5FbmRwb2ludCgpLFxuICAgICAgbG9naW5Vcmw6IHRoaXMuYXV0aENvbmZpZ1NlcnZpY2UuZ2V0TG9naW5VcmwoKSxcbiAgICAgIGNsaWVudElkOiB0aGlzLmF1dGhDb25maWdTZXJ2aWNlLmdldENsaWVudElkKCksXG4gICAgICBkdW1teUNsaWVudFNlY3JldDogdGhpcy5hdXRoQ29uZmlnU2VydmljZS5nZXRDbGllbnRTZWNyZXQoKSxcbiAgICAgIHJldm9jYXRpb25FbmRwb2ludDogdGhpcy5hdXRoQ29uZmlnU2VydmljZS5nZXRSZXZva2VFbmRwb2ludCgpLFxuICAgICAgbG9nb3V0VXJsOiB0aGlzLmF1dGhDb25maWdTZXJ2aWNlLmdldExvZ291dFVybCgpLFxuICAgICAgdXNlcmluZm9FbmRwb2ludDogdGhpcy5hdXRoQ29uZmlnU2VydmljZS5nZXRVc2VyaW5mb0VuZHBvaW50KCksXG4gICAgICBpc3N1ZXI6XG4gICAgICAgIHRoaXMuYXV0aENvbmZpZ1NlcnZpY2UuZ2V0T0F1dGhMaWJDb25maWcoKT8uaXNzdWVyID8/XG4gICAgICAgIHRoaXMuYXV0aENvbmZpZ1NlcnZpY2UuZ2V0QmFzZVVybCgpLFxuICAgICAgcmVkaXJlY3RVcmk6XG4gICAgICAgIHRoaXMuYXV0aENvbmZpZ1NlcnZpY2UuZ2V0T0F1dGhMaWJDb25maWcoKT8ucmVkaXJlY3RVcmkgPz9cbiAgICAgICAgKCFpc1NTUlxuICAgICAgICAgID8gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIHRoaXMud2luUmVmLm5hdGl2ZVdpbmRvdyEubG9jYXRpb24ub3JpZ2luXG4gICAgICAgICAgOiAnJyksXG4gICAgICAuLi50aGlzLmF1dGhDb25maWdTZXJ2aWNlLmdldE9BdXRoTGliQ29uZmlnKCksXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQXV0aG9yaXplIHdpdGggUmVzb3VyY2VPd25lclBhc3N3b3JkRmxvdy5cbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gcGFzc3dvcmRcbiAgICpcbiAgICogQHJldHVybiB0b2tlbiByZXNwb25zZSBmcm9tIHRoZSBsaWJcbiAgICovXG4gIGF1dGhvcml6ZVdpdGhQYXNzd29yZEZsb3coXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZ1xuICApOiBQcm9taXNlPFRva2VuUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5vQXV0aFNlcnZpY2UuZmV0Y2hUb2tlblVzaW5nUGFzc3dvcmRGbG93KHVzZXJJZCwgcGFzc3dvcmQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZnJlc2ggYWNjZXNzX3Rva2VuLlxuICAgKi9cbiAgcmVmcmVzaFRva2VuKCk6IHZvaWQge1xuICAgIHRoaXMub0F1dGhTZXJ2aWNlLnJlZnJlc2hUb2tlbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldm9rZSBhY2Nlc3MgdG9rZW5zIGFuZCBjbGVhciB0b2tlbnMgaW4gbGliIHN0YXRlLlxuICAgKi9cbiAgcmV2b2tlQW5kTG9nb3V0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5vQXV0aFNlcnZpY2VcbiAgICAgICAgLnJldm9rZVRva2VuQW5kTG9nb3V0KClcbiAgICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAvLyB3aGVuIHRoZXJlIHdvdWxkIGJlIHNvbWUga2luZCBvZiBlcnJvciBkdXJpbmcgcmV2b2NhdGlvbiB3ZSBjYW4ndCBkbyBhbnl0aGluZyBlbHNlLCBzbyBhdCBsZWFzdCB3ZSBsb2dvdXQgdXNlci5cbiAgICAgICAgICB0aGlzLm9BdXRoU2VydmljZS5sb2dPdXQoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgdG9rZW5zIGluIGxpYnJhcnkgc3RhdGUgKG5vIHJldm9jYXRpb24pLlxuICAgKi9cbiAgbG9nb3V0KCk6IHZvaWQge1xuICAgIHRoaXMub0F1dGhTZXJ2aWNlLmxvZ091dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgT3BlbiBJZCB0b2tlbi4gTWlnaHQgYmUgZW1wdHksIHdoZW4gaXQgd2FzIG5vdCByZXF1ZXN0ZWQgd2l0aCB0aGUgYHJlc3BvbnNlVHlwZWAgY29uZmlnLlxuICAgKlxuICAgKiBAcmV0dXJuIGlkIHRva2VuXG4gICAqL1xuICBnZXRJZFRva2VuKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMub0F1dGhTZXJ2aWNlLmdldElkVG9rZW4oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIEltcGxpY2l0IEZsb3cgb3IgQXV0aG9yaXphdGlvbiBDb2RlIGZsb3dzIHdpdGggdGhlIHJlZGlyZWN0IHRvIE9BdXRoIGxvZ2luIHVybC5cbiAgICovXG4gIGluaXRMb2dpbkZsb3coKSB7XG4gICAgcmV0dXJuIHRoaXMub0F1dGhTZXJ2aWNlLmluaXRMb2dpbkZsb3coKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmllcyB0byBsb2dpbiB1c2VyIGJhc2VkIG9uIGBjb2RlYCBvciBgdG9rZW5gIHByZXNlbnQgaW4gdGhlIHVybC5cbiAgICovXG4gIHRyeUxvZ2luKCkge1xuICAgIHJldHVybiB0aGlzLm9BdXRoU2VydmljZS50cnlMb2dpbih7XG4gICAgICAvLyBXZSBkb24ndCBsb2FkIGRpc2NvdmVyeSBkb2N1bWVudCwgYmVjYXVzZSBpdCBkb2Vzbid0IGNvbnRhaW4gcmV2b2tlIGVuZHBvaW50IGluZm9ybWF0aW9uXG4gICAgICBkaXNhYmxlT0F1dGgyU3RhdGVDaGVjazogdHJ1ZSxcbiAgICB9KTtcbiAgfVxufVxuIl19
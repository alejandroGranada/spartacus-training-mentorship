import { DOCUMENT, isPlatformBrowser } from '@angular/common';
import { Inject, Injectable, Optional, PLATFORM_ID } from '@angular/core';
import { fromEvent, of } from 'rxjs';
import { debounceTime, distinctUntilChanged, startWith } from 'rxjs/operators';
import { SERVER_REQUEST_ORIGIN, SERVER_REQUEST_URL } from '../util/ssr.tokens';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../util/ssr.tokens";
export class WindowRef {
    // TODO(#11133): Make platformId required in 4.0
    /**
     * @deprecated since 3.2. Provide PLATFORM_ID, serverRequestUrl and serverRequestOrigin as constructor parameters
     */
    constructor(
    // https://github.com/angular/angular/issues/20351
    document, platformId, serverUrl, serverOrigin) {
        this.platformId = platformId;
        this.serverUrl = serverUrl;
        this.serverOrigin = serverOrigin;
        this.document = document;
    }
    /**
     * Returns true when invoked in browser context.
     * Use this method to check if you can access `window` and other browser globals.
     */
    isBrowser() {
        // TODO(#11133): Remove condition when platformId will be always provided
        return this.platformId
            ? isPlatformBrowser(this.platformId)
            : typeof window !== 'undefined';
    }
    /**
     * Exposes global `window` object. In SSR when `window` is not available it returns `undefined`.
     * To detect if you can safely use `nativeWindow` use `isBrowser` to check execution platform.
     */
    get nativeWindow() {
        // TODO(#11133): Consider throwing in SSR
        return this.isBrowser() ? window : undefined;
    }
    /**
     * Exposes global `sessionStorage` object. In SSR when `sessionStorage` is not available it returns `undefined`.
     * To detect if you can safely use `sessionStorage` use `isBrowser` to check execution platform.
     */
    get sessionStorage() {
        return this.nativeWindow ? this.nativeWindow.sessionStorage : undefined;
    }
    /**
     * Exposes global `localStorage` object. In SSR when `localStorage` is not available it returns `undefined`.
     * To detect if you can safely use `localStorage` use `isBrowser` to check execution platform.
     */
    get localStorage() {
        return this.nativeWindow ? this.nativeWindow.localStorage : undefined;
    }
    /**
     * Returns the window/document location, unless it's not available (i.e. SSR).
     *
     * When there's no access to the location object, we mimic the location partially, by resolving
     * the request url (`SERVER_REQUEST_URL`) and origin (`SERVER_REQUEST_ORIGIN`) from the injector.
     * These values are injected in the server implementation so that we can resolve some of the location
     * values when we do server side rendering.
     */
    get location() {
        if (this.isBrowser()) {
            return this.document.location;
        }
        else {
            if (!this.serverUrl) {
                throw new Error('Cannot resolve the href as the SERVER_REQUEST_URL is undefined');
            }
            if (!this.serverOrigin) {
                throw new Error('Cannot resolve the origin as the SERVER_REQUEST_ORIGIN is undefined');
            }
            return {
                href: this.serverUrl,
                origin: this.serverOrigin,
            };
        }
    }
    /**
     * Returns an observable for the window resize event and emits an event
     * every 300ms in case of resizing. An event is simulated initially.
     *
     * If there's no window object available (i.e. in SSR), a null value is emitted.
     */
    get resize$() {
        if (!this.nativeWindow) {
            return of(null);
        }
        else {
            return fromEvent(this.nativeWindow, 'resize').pipe(debounceTime(300), startWith({ target: this.nativeWindow }), distinctUntilChanged());
        }
    }
}
WindowRef.ɵprov = i0.ɵɵdefineInjectable({ factory: function WindowRef_Factory() { return new WindowRef(i0.ɵɵinject(i1.DOCUMENT), i0.ɵɵinject(i0.PLATFORM_ID), i0.ɵɵinject(i2.SERVER_REQUEST_URL, 8), i0.ɵɵinject(i2.SERVER_REQUEST_ORIGIN, 8)); }, token: WindowRef, providedIn: "root" });
WindowRef.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
WindowRef.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SERVER_REQUEST_URL,] }] },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SERVER_REQUEST_ORIGIN,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luZG93LXJlZi5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9QYXRyeWsvRGVza3RvcC9zcGFydGFjdXMvcHJvamVjdHMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy93aW5kb3cvd2luZG93LXJlZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRSxPQUFPLEVBQUUsU0FBUyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsWUFBWSxFQUFFLG9CQUFvQixFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9FLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDOzs7O0FBSy9FLE1BQU0sT0FBTyxTQUFTO0lBR3BCLGdEQUFnRDtJQUNoRDs7T0FFRztJQUNIO0lBQ0Usa0RBQWtEO0lBQ2hDLFFBQWEsRUFDQSxVQUFtQixFQUNBLFNBQWtCLEVBQ2YsWUFBcUI7UUFGM0MsZUFBVSxHQUFWLFVBQVUsQ0FBUztRQUNBLGNBQVMsR0FBVCxTQUFTLENBQVM7UUFDZixpQkFBWSxHQUFaLFlBQVksQ0FBUztRQUUxRSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQW9CLENBQUM7SUFDdkMsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVM7UUFDUCx5RUFBeUU7UUFDekUsT0FBTyxJQUFJLENBQUMsVUFBVTtZQUNwQixDQUFDLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNwQyxDQUFDLENBQUMsT0FBTyxNQUFNLEtBQUssV0FBVyxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLFlBQVk7UUFDZCx5Q0FBeUM7UUFDekMsT0FBTyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLGNBQWM7UUFDaEIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQzFFLENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFJLFlBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDeEUsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxJQUFJLFFBQVE7UUFDVixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNwQixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO1NBQy9CO2FBQU07WUFDTCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDbkIsTUFBTSxJQUFJLEtBQUssQ0FDYixnRUFBZ0UsQ0FDakUsQ0FBQzthQUNIO1lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQ2IscUVBQXFFLENBQ3RFLENBQUM7YUFDSDtZQUNELE9BQU87Z0JBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTO2dCQUNwQixNQUFNLEVBQUUsSUFBSSxDQUFDLFlBQVk7YUFDMUIsQ0FBQztTQUNIO0lBQ0gsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsSUFBSSxPQUFPO1FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdEIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDakI7YUFBTTtZQUNMLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUNoRCxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQ2pCLFNBQVMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsRUFDeEMsb0JBQW9CLEVBQUUsQ0FDdkIsQ0FBQztTQUNIO0lBQ0gsQ0FBQzs7OztZQXJHRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7Ozs0Q0FVSSxNQUFNLFNBQUMsUUFBUTtZQUM0QixNQUFNLHVCQUFqRCxNQUFNLFNBQUMsV0FBVzt5Q0FDbEIsUUFBUSxZQUFJLE1BQU0sU0FBQyxrQkFBa0I7eUNBQ3JDLFFBQVEsWUFBSSxNQUFNLFNBQUMscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9DVU1FTlQsIGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwsIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBzdGFydFdpdGggfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTRVJWRVJfUkVRVUVTVF9PUklHSU4sIFNFUlZFUl9SRVFVRVNUX1VSTCB9IGZyb20gJy4uL3V0aWwvc3NyLnRva2Vucyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBXaW5kb3dSZWYge1xuICByZWFkb25seSBkb2N1bWVudDogRG9jdW1lbnQ7XG5cbiAgLy8gVE9ETygjMTExMzMpOiBNYWtlIHBsYXRmb3JtSWQgcmVxdWlyZWQgaW4gNC4wXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBzaW5jZSAzLjIuIFByb3ZpZGUgUExBVEZPUk1fSUQsIHNlcnZlclJlcXVlc3RVcmwgYW5kIHNlcnZlclJlcXVlc3RPcmlnaW4gYXMgY29uc3RydWN0b3IgcGFyYW1ldGVyc1xuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMjAzNTFcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBkb2N1bWVudDogYW55LFxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByb3RlY3RlZCBwbGF0Zm9ybUlkPzogT2JqZWN0LFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU0VSVkVSX1JFUVVFU1RfVVJMKSBwcm90ZWN0ZWQgc2VydmVyVXJsPzogc3RyaW5nLFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoU0VSVkVSX1JFUVVFU1RfT1JJR0lOKSBwcm90ZWN0ZWQgc2VydmVyT3JpZ2luPzogc3RyaW5nXG4gICkge1xuICAgIHRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudCBhcyBEb2N1bWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRydWUgd2hlbiBpbnZva2VkIGluIGJyb3dzZXIgY29udGV4dC5cbiAgICogVXNlIHRoaXMgbWV0aG9kIHRvIGNoZWNrIGlmIHlvdSBjYW4gYWNjZXNzIGB3aW5kb3dgIGFuZCBvdGhlciBicm93c2VyIGdsb2JhbHMuXG4gICAqL1xuICBpc0Jyb3dzZXIoKTogYm9vbGVhbiB7XG4gICAgLy8gVE9ETygjMTExMzMpOiBSZW1vdmUgY29uZGl0aW9uIHdoZW4gcGxhdGZvcm1JZCB3aWxsIGJlIGFsd2F5cyBwcm92aWRlZFxuICAgIHJldHVybiB0aGlzLnBsYXRmb3JtSWRcbiAgICAgID8gaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKVxuICAgICAgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvc2VzIGdsb2JhbCBgd2luZG93YCBvYmplY3QuIEluIFNTUiB3aGVuIGB3aW5kb3dgIGlzIG5vdCBhdmFpbGFibGUgaXQgcmV0dXJucyBgdW5kZWZpbmVkYC5cbiAgICogVG8gZGV0ZWN0IGlmIHlvdSBjYW4gc2FmZWx5IHVzZSBgbmF0aXZlV2luZG93YCB1c2UgYGlzQnJvd3NlcmAgdG8gY2hlY2sgZXhlY3V0aW9uIHBsYXRmb3JtLlxuICAgKi9cbiAgZ2V0IG5hdGl2ZVdpbmRvdygpOiBXaW5kb3cgfCB1bmRlZmluZWQge1xuICAgIC8vIFRPRE8oIzExMTMzKTogQ29uc2lkZXIgdGhyb3dpbmcgaW4gU1NSXG4gICAgcmV0dXJuIHRoaXMuaXNCcm93c2VyKCkgPyB3aW5kb3cgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogRXhwb3NlcyBnbG9iYWwgYHNlc3Npb25TdG9yYWdlYCBvYmplY3QuIEluIFNTUiB3aGVuIGBzZXNzaW9uU3RvcmFnZWAgaXMgbm90IGF2YWlsYWJsZSBpdCByZXR1cm5zIGB1bmRlZmluZWRgLlxuICAgKiBUbyBkZXRlY3QgaWYgeW91IGNhbiBzYWZlbHkgdXNlIGBzZXNzaW9uU3RvcmFnZWAgdXNlIGBpc0Jyb3dzZXJgIHRvIGNoZWNrIGV4ZWN1dGlvbiBwbGF0Zm9ybS5cbiAgICovXG4gIGdldCBzZXNzaW9uU3RvcmFnZSgpOiBTdG9yYWdlIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5uYXRpdmVXaW5kb3cgPyB0aGlzLm5hdGl2ZVdpbmRvdy5zZXNzaW9uU3RvcmFnZSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvc2VzIGdsb2JhbCBgbG9jYWxTdG9yYWdlYCBvYmplY3QuIEluIFNTUiB3aGVuIGBsb2NhbFN0b3JhZ2VgIGlzIG5vdCBhdmFpbGFibGUgaXQgcmV0dXJucyBgdW5kZWZpbmVkYC5cbiAgICogVG8gZGV0ZWN0IGlmIHlvdSBjYW4gc2FmZWx5IHVzZSBgbG9jYWxTdG9yYWdlYCB1c2UgYGlzQnJvd3NlcmAgdG8gY2hlY2sgZXhlY3V0aW9uIHBsYXRmb3JtLlxuICAgKi9cbiAgZ2V0IGxvY2FsU3RvcmFnZSgpOiBTdG9yYWdlIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5uYXRpdmVXaW5kb3cgPyB0aGlzLm5hdGl2ZVdpbmRvdy5sb2NhbFN0b3JhZ2UgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgd2luZG93L2RvY3VtZW50IGxvY2F0aW9uLCB1bmxlc3MgaXQncyBub3QgYXZhaWxhYmxlIChpLmUuIFNTUikuXG4gICAqXG4gICAqIFdoZW4gdGhlcmUncyBubyBhY2Nlc3MgdG8gdGhlIGxvY2F0aW9uIG9iamVjdCwgd2UgbWltaWMgdGhlIGxvY2F0aW9uIHBhcnRpYWxseSwgYnkgcmVzb2x2aW5nXG4gICAqIHRoZSByZXF1ZXN0IHVybCAoYFNFUlZFUl9SRVFVRVNUX1VSTGApIGFuZCBvcmlnaW4gKGBTRVJWRVJfUkVRVUVTVF9PUklHSU5gKSBmcm9tIHRoZSBpbmplY3Rvci5cbiAgICogVGhlc2UgdmFsdWVzIGFyZSBpbmplY3RlZCBpbiB0aGUgc2VydmVyIGltcGxlbWVudGF0aW9uIHNvIHRoYXQgd2UgY2FuIHJlc29sdmUgc29tZSBvZiB0aGUgbG9jYXRpb25cbiAgICogdmFsdWVzIHdoZW4gd2UgZG8gc2VydmVyIHNpZGUgcmVuZGVyaW5nLlxuICAgKi9cbiAgZ2V0IGxvY2F0aW9uKCk6IFBhcnRpYWw8TG9jYXRpb24+IHtcbiAgICBpZiAodGhpcy5pc0Jyb3dzZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQubG9jYXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghdGhpcy5zZXJ2ZXJVcmwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgcmVzb2x2ZSB0aGUgaHJlZiBhcyB0aGUgU0VSVkVSX1JFUVVFU1RfVVJMIGlzIHVuZGVmaW5lZCdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5zZXJ2ZXJPcmlnaW4pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgcmVzb2x2ZSB0aGUgb3JpZ2luIGFzIHRoZSBTRVJWRVJfUkVRVUVTVF9PUklHSU4gaXMgdW5kZWZpbmVkJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaHJlZjogdGhpcy5zZXJ2ZXJVcmwsXG4gICAgICAgIG9yaWdpbjogdGhpcy5zZXJ2ZXJPcmlnaW4sXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIG9ic2VydmFibGUgZm9yIHRoZSB3aW5kb3cgcmVzaXplIGV2ZW50IGFuZCBlbWl0cyBhbiBldmVudFxuICAgKiBldmVyeSAzMDBtcyBpbiBjYXNlIG9mIHJlc2l6aW5nLiBBbiBldmVudCBpcyBzaW11bGF0ZWQgaW5pdGlhbGx5LlxuICAgKlxuICAgKiBJZiB0aGVyZSdzIG5vIHdpbmRvdyBvYmplY3QgYXZhaWxhYmxlIChpLmUuIGluIFNTUiksIGEgbnVsbCB2YWx1ZSBpcyBlbWl0dGVkLlxuICAgKi9cbiAgZ2V0IHJlc2l6ZSQoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMubmF0aXZlV2luZG93KSB7XG4gICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmcm9tRXZlbnQodGhpcy5uYXRpdmVXaW5kb3csICdyZXNpemUnKS5waXBlKFxuICAgICAgICBkZWJvdW5jZVRpbWUoMzAwKSxcbiAgICAgICAgc3RhcnRXaXRoKHsgdGFyZ2V0OiB0aGlzLm5hdGl2ZVdpbmRvdyB9KSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==
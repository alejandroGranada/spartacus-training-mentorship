import { Location } from '@angular/common';
import { Injectable } from '@angular/core';
import { FeatureModulesService } from '@spartacus/core';
import { SmartEditConfig } from '../config/smart-edit-config';
import * as i0 from "@angular/core";
import * as i1 from "../config/smart-edit-config";
import * as i2 from "@angular/common";
import * as i3 from "@spartacus/core";
/**
 * The SmartEditLauncherService is used to check whether Spartacus is launched inside Smart Edit;
 * it also gets cmsTicketId sent from Smart Edit.
 */
export class SmartEditLauncherService {
    constructor(config, location, featureModules) {
        this.config = config;
        this.location = location;
        this.featureModules = featureModules;
    }
    get cmsTicketId() {
        return this._cmsTicketId;
    }
    /**
     * Lazy loads modules when Spartacus launced inside Smart Edit
     */
    load() {
        if (this.isLaunchedInSmartEdit() &&
            this.featureModules.isConfigured('smartEdit')) {
            this.featureModules.resolveFeature('smartEdit').subscribe();
        }
    }
    /**
     * Indicates whether Spartacus is launched in SmartEdit
     */
    isLaunchedInSmartEdit() {
        const path = this.location.path().split('?')[0];
        const params = this.location.path().split('?')[1];
        const cmsToken = params === null || params === void 0 ? void 0 : params.split('&').find((param) => param.startsWith('cmsTicketId='));
        this._cmsTicketId = cmsToken === null || cmsToken === void 0 ? void 0 : cmsToken.split('=')[1];
        return (path.split('/').pop() === this.config.smartEdit.storefrontPreviewRoute &&
            !!this._cmsTicketId);
    }
}
SmartEditLauncherService.ɵprov = i0.ɵɵdefineInjectable({ factory: function SmartEditLauncherService_Factory() { return new SmartEditLauncherService(i0.ɵɵinject(i1.SmartEditConfig), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.FeatureModulesService)); }, token: SmartEditLauncherService, providedIn: "root" });
SmartEditLauncherService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
SmartEditLauncherService.ctorParameters = () => [
    { type: SmartEditConfig },
    { type: Location },
    { type: FeatureModulesService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21hcnQtZWRpdC1sYXVuY2hlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IkM6L1VzZXJzL1BhdHJ5ay9EZXNrdG9wL3NwYXJ0YWN1cy9mZWF0dXJlLWxpYnMvc21hcnRlZGl0L3Jvb3QvIiwic291cmNlcyI6WyJzZXJ2aWNlcy9zbWFydC1lZGl0LWxhdW5jaGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDZCQUE2QixDQUFDOzs7OztBQUU5RDs7O0dBR0c7QUFJSCxNQUFNLE9BQU8sd0JBQXdCO0lBT25DLFlBQ1ksTUFBdUIsRUFDdkIsUUFBa0IsRUFDbEIsY0FBcUM7UUFGckMsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFDdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixtQkFBYyxHQUFkLGNBQWMsQ0FBdUI7SUFDOUMsQ0FBQztJQVJKLElBQUksV0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0lBUUQ7O09BRUc7SUFDSCxJQUFJO1FBQ0YsSUFDRSxJQUFJLENBQUMscUJBQXFCLEVBQUU7WUFDNUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLEVBQzdDO1lBQ0EsSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7U0FDN0Q7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUNuQixLQUFLLENBQUMsR0FBRyxFQUNWLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxZQUFZLEdBQUcsUUFBUSxhQUFSLFFBQVEsdUJBQVIsUUFBUSxDQUFFLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFNUMsT0FBTyxDQUNMLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsc0JBQXNCO1lBQ3RFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUNwQixDQUFDO0lBQ0osQ0FBQzs7OztZQTNDRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7OztZQVJRLGVBQWU7WUFIZixRQUFRO1lBRVIscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9jYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRmVhdHVyZU1vZHVsZXNTZXJ2aWNlIH0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IFNtYXJ0RWRpdENvbmZpZyB9IGZyb20gJy4uL2NvbmZpZy9zbWFydC1lZGl0LWNvbmZpZyc7XG5cbi8qKlxuICogVGhlIFNtYXJ0RWRpdExhdW5jaGVyU2VydmljZSBpcyB1c2VkIHRvIGNoZWNrIHdoZXRoZXIgU3BhcnRhY3VzIGlzIGxhdW5jaGVkIGluc2lkZSBTbWFydCBFZGl0O1xuICogaXQgYWxzbyBnZXRzIGNtc1RpY2tldElkIHNlbnQgZnJvbSBTbWFydCBFZGl0LlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgU21hcnRFZGl0TGF1bmNoZXJTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBfY21zVGlja2V0SWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICBnZXQgY21zVGlja2V0SWQoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fY21zVGlja2V0SWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlnOiBTbWFydEVkaXRDb25maWcsXG4gICAgcHJvdGVjdGVkIGxvY2F0aW9uOiBMb2NhdGlvbixcbiAgICBwcm90ZWN0ZWQgZmVhdHVyZU1vZHVsZXM6IEZlYXR1cmVNb2R1bGVzU2VydmljZVxuICApIHt9XG5cbiAgLyoqXG4gICAqIExhenkgbG9hZHMgbW9kdWxlcyB3aGVuIFNwYXJ0YWN1cyBsYXVuY2VkIGluc2lkZSBTbWFydCBFZGl0XG4gICAqL1xuICBsb2FkKCk6IHZvaWQge1xuICAgIGlmIChcbiAgICAgIHRoaXMuaXNMYXVuY2hlZEluU21hcnRFZGl0KCkgJiZcbiAgICAgIHRoaXMuZmVhdHVyZU1vZHVsZXMuaXNDb25maWd1cmVkKCdzbWFydEVkaXQnKVxuICAgICkge1xuICAgICAgdGhpcy5mZWF0dXJlTW9kdWxlcy5yZXNvbHZlRmVhdHVyZSgnc21hcnRFZGl0Jykuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIFNwYXJ0YWN1cyBpcyBsYXVuY2hlZCBpbiBTbWFydEVkaXRcbiAgICovXG4gIGlzTGF1bmNoZWRJblNtYXJ0RWRpdCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBwYXRoID0gdGhpcy5sb2NhdGlvbi5wYXRoKCkuc3BsaXQoJz8nKVswXTtcbiAgICBjb25zdCBwYXJhbXMgPSB0aGlzLmxvY2F0aW9uLnBhdGgoKS5zcGxpdCgnPycpWzFdO1xuICAgIGNvbnN0IGNtc1Rva2VuID0gcGFyYW1zXG4gICAgICA/LnNwbGl0KCcmJylcbiAgICAgIC5maW5kKChwYXJhbSkgPT4gcGFyYW0uc3RhcnRzV2l0aCgnY21zVGlja2V0SWQ9JykpO1xuICAgIHRoaXMuX2Ntc1RpY2tldElkID0gY21zVG9rZW4/LnNwbGl0KCc9JylbMV07XG5cbiAgICByZXR1cm4gKFxuICAgICAgcGF0aC5zcGxpdCgnLycpLnBvcCgpID09PSB0aGlzLmNvbmZpZy5zbWFydEVkaXQuc3RvcmVmcm9udFByZXZpZXdSb3V0ZSAmJlxuICAgICAgISF0aGlzLl9jbXNUaWNrZXRJZFxuICAgICk7XG4gIH1cbn1cbiJdfQ==
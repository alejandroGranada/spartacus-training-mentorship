import { Injectable } from '@angular/core';
import { UserAccountChangedEvent, } from '@spartacus/user/account/root';
import { LoginEvent, LogoutEvent, QueryService, UserIdService, } from '@spartacus/core';
import { switchMap } from 'rxjs/operators';
import { UserAccountConnector } from '../connectors/user-account.connector';
export class UserAccountService {
    constructor(userAccountConnector, userIdService, query) {
        this.userAccountConnector = userAccountConnector;
        this.userIdService = userIdService;
        this.query = query;
        this.userQuery = this.query.create(() => this.userIdService
            .takeUserId(true)
            .pipe(switchMap((userId) => this.userAccountConnector.get(userId))), {
            reloadOn: [UserAccountChangedEvent],
            resetOn: [LoginEvent, LogoutEvent],
        });
    }
    /**
     * Returns the current user.
     */
    get() {
        return this.userQuery.get();
    }
}
UserAccountService.decorators = [
    { type: Injectable }
];
UserAccountService.ctorParameters = () => [
    { type: UserAccountConnector },
    { type: UserIdService },
    { type: QueryService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1hY2NvdW50LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiQzovVXNlcnMvUGF0cnlrL0Rlc2t0b3Avc3BhcnRhY3VzL2ZlYXR1cmUtbGlicy91c2VyL2FjY291bnQvY29yZS8iLCJzb3VyY2VzIjpbImZhY2FkZS91c2VyLWFjY291bnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFFTCx1QkFBdUIsR0FFeEIsTUFBTSw4QkFBOEIsQ0FBQztBQUN0QyxPQUFPLEVBQ0wsVUFBVSxFQUNWLFdBQVcsRUFFWCxZQUFZLEVBQ1osYUFBYSxHQUNkLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBRzVFLE1BQU0sT0FBTyxrQkFBa0I7SUFZN0IsWUFDWSxvQkFBMEMsRUFDMUMsYUFBNEIsRUFDNUIsS0FBbUI7UUFGbkIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixVQUFLLEdBQUwsS0FBSyxDQUFjO1FBZHJCLGNBQVMsR0FBZ0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQ2xELEdBQUcsRUFBRSxDQUNILElBQUksQ0FBQyxhQUFhO2FBQ2YsVUFBVSxDQUFDLElBQUksQ0FBQzthQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFDdkU7WUFDRSxRQUFRLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQztZQUNuQyxPQUFPLEVBQUUsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDO1NBQ25DLENBQ0YsQ0FBQztJQU1DLENBQUM7SUFFSjs7T0FFRztJQUNILEdBQUc7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUIsQ0FBQzs7O1lBeEJGLFVBQVU7OztZQUZGLG9CQUFvQjtZQUgzQixhQUFhO1lBRGIsWUFBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIFVzZXIsXG4gIFVzZXJBY2NvdW50Q2hhbmdlZEV2ZW50LFxuICBVc2VyQWNjb3VudEZhY2FkZSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy91c2VyL2FjY291bnQvcm9vdCc7XG5pbXBvcnQge1xuICBMb2dpbkV2ZW50LFxuICBMb2dvdXRFdmVudCxcbiAgUXVlcnksXG4gIFF1ZXJ5U2VydmljZSxcbiAgVXNlcklkU2VydmljZSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFVzZXJBY2NvdW50Q29ubmVjdG9yIH0gZnJvbSAnLi4vY29ubmVjdG9ycy91c2VyLWFjY291bnQuY29ubmVjdG9yJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFVzZXJBY2NvdW50U2VydmljZSBpbXBsZW1lbnRzIFVzZXJBY2NvdW50RmFjYWRlIHtcbiAgcHJvdGVjdGVkIHVzZXJRdWVyeTogUXVlcnk8VXNlcj4gPSB0aGlzLnF1ZXJ5LmNyZWF0ZShcbiAgICAoKSA9PlxuICAgICAgdGhpcy51c2VySWRTZXJ2aWNlXG4gICAgICAgIC50YWtlVXNlcklkKHRydWUpXG4gICAgICAgIC5waXBlKHN3aXRjaE1hcCgodXNlcklkKSA9PiB0aGlzLnVzZXJBY2NvdW50Q29ubmVjdG9yLmdldCh1c2VySWQpKSksXG4gICAge1xuICAgICAgcmVsb2FkT246IFtVc2VyQWNjb3VudENoYW5nZWRFdmVudF0sXG4gICAgICByZXNldE9uOiBbTG9naW5FdmVudCwgTG9nb3V0RXZlbnRdLFxuICAgIH1cbiAgKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdXNlckFjY291bnRDb25uZWN0b3I6IFVzZXJBY2NvdW50Q29ubmVjdG9yLFxuICAgIHByb3RlY3RlZCB1c2VySWRTZXJ2aWNlOiBVc2VySWRTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBxdWVyeTogUXVlcnlTZXJ2aWNlXG4gICkge31cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyLlxuICAgKi9cbiAgZ2V0KCk6IE9ic2VydmFibGU8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLnVzZXJRdWVyeS5nZXQoKTtcbiAgfVxufVxuIl19
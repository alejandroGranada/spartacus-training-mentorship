{"version":3,"file":"spartacus-user-account-components.js","sources":["../../../feature-libs/user/account/components/login-form/login-form-component.service.ts","../../../feature-libs/user/account/components/login-form/login-form.component.ts","../../../feature-libs/user/account/components/login-form/login-form.module.ts","../../../feature-libs/user/account/components/login-register/login-register.component.ts","../../../feature-libs/user/account/components/login-register/login-register.module.ts","../../../feature-libs/user/account/components/login/login.component.ts","../../../feature-libs/user/account/components/login/login.module.ts","../../../feature-libs/user/account/components/user-account-component.module.ts","../../../feature-libs/user/account/components/spartacus-user-account-components.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport {\n  AuthService,\n  GlobalMessageService,\n  GlobalMessageType,\n  WindowRef,\n} from '@spartacus/core';\nimport { CustomFormValidators } from '@spartacus/storefront';\nimport { BehaviorSubject, from } from 'rxjs';\nimport { tap, withLatestFrom } from 'rxjs/operators';\n\n@Injectable()\nexport class LoginFormComponentService {\n  constructor(\n    protected auth: AuthService,\n    protected globalMessage: GlobalMessageService,\n    protected winRef: WindowRef\n  ) {}\n\n  protected busy$ = new BehaviorSubject(false);\n\n  isUpdating$ = this.busy$.pipe(\n    tap((state) => {\n      const userId = this.winRef.nativeWindow?.history?.state?.['newUid'];\n      if (userId) {\n        this.form.patchValue({ userId });\n      }\n      state === true ? this.form.disable() : this.form.enable();\n    })\n  );\n\n  form: FormGroup = new FormGroup({\n    userId: new FormControl('', [\n      Validators.required,\n      CustomFormValidators.emailValidator,\n    ]),\n    password: new FormControl('', Validators.required),\n  });\n\n  login() {\n    if (!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n\n    this.busy$.next(true);\n\n    from(\n      this.auth.loginWithCredentials(\n        // TODO: consider dropping toLowerCase as this should not be part of the UI,\n        // as it's too opinionated and doesn't work with other AUTH services\n        this.form.value.userId.toLowerCase(),\n        this.form.value.password\n      )\n    )\n      .pipe(\n        withLatestFrom(this.auth.isUserLoggedIn()),\n        tap(([_, isLoggedIn]) => this.onSuccess(isLoggedIn))\n      )\n      .subscribe();\n  }\n\n  protected onSuccess(isLoggedIn: boolean): void {\n    if (isLoggedIn) {\n      // We want to remove error messages on successful login (primary the bad\n      // username/password combination)\n      this.globalMessage.remove(GlobalMessageType.MSG_TYPE_ERROR);\n      this.form.reset();\n    }\n\n    this.busy$.next(false);\n  }\n}\n","import { ChangeDetectionStrategy, Component, HostBinding } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { LoginFormComponentService } from './login-form-component.service';\n\n@Component({\n  selector: 'cx-login-form',\n  templateUrl: './login-form.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class LoginFormComponent {\n  constructor(protected service: LoginFormComponentService) {}\n\n  form: FormGroup = this.service.form;\n  isUpdating$ = this.service.isUpdating$;\n\n  @HostBinding('class.user-form') style = true;\n\n  onSubmit(): void {\n    this.service.login();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport {\n  AuthService,\n  CmsConfig,\n  GlobalMessageService,\n  I18nModule,\n  NotAuthGuard,\n  provideDefaultConfig,\n  UrlModule,\n  WindowRef,\n} from '@spartacus/core';\nimport { FormErrorsModule, SpinnerModule } from '@spartacus/storefront';\nimport { LoginFormComponentService } from './login-form-component.service';\nimport { LoginFormComponent } from './login-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    RouterModule,\n    UrlModule,\n    I18nModule,\n    FormErrorsModule,\n    SpinnerModule,\n  ],\n  providers: [\n    provideDefaultConfig(<CmsConfig>{\n      cmsComponents: {\n        ReturningCustomerLoginComponent: {\n          component: LoginFormComponent,\n          guards: [NotAuthGuard],\n          providers: [\n            {\n              provide: LoginFormComponentService,\n              useClass: LoginFormComponentService,\n              deps: [AuthService, GlobalMessageService, WindowRef],\n            },\n          ],\n        },\n      },\n    }),\n  ],\n  declarations: [LoginFormComponent],\n})\nexport class LoginFormModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { CheckoutConfigService } from '@spartacus/storefront';\n\n@Component({\n  selector: 'cx-login-register',\n  templateUrl: './login-register.component.html',\n})\nexport class LoginRegisterComponent implements OnInit {\n  loginAsGuest = false;\n\n  constructor(\n    protected checkoutConfigService: CheckoutConfigService,\n    protected activatedRoute: ActivatedRoute\n  ) {}\n\n  ngOnInit(): void {\n    // TODO: consider using events or inputs to avoid depending on checkout library\n    if (this.checkoutConfigService.isGuestCheckout()) {\n      this.loginAsGuest = this.activatedRoute.snapshot.queryParams['forced'];\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport {\n  CmsConfig,\n  I18nModule,\n  NotAuthGuard,\n  provideDefaultConfig,\n  UrlModule,\n} from '@spartacus/core';\nimport { PageSlotModule } from '@spartacus/storefront';\nimport { LoginRegisterComponent } from './login-register.component';\n\n@NgModule({\n  imports: [CommonModule, RouterModule, UrlModule, PageSlotModule, I18nModule],\n  providers: [\n    provideDefaultConfig(<CmsConfig>{\n      cmsComponents: {\n        ReturningCustomerRegisterComponent: {\n          component: LoginRegisterComponent,\n          guards: [NotAuthGuard],\n        },\n      },\n    }),\n  ],\n  declarations: [LoginRegisterComponent],\n})\nexport class LoginRegisterModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { AuthService } from '@spartacus/core';\nimport { User, UserAccountFacade } from '@spartacus/user/account/root';\nimport { Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\n@Component({\n  selector: 'cx-login',\n  templateUrl: './login.component.html',\n})\nexport class LoginComponent implements OnInit {\n  user$: Observable<User | undefined>;\n\n  constructor(\n    private auth: AuthService,\n    private userAccount: UserAccountFacade\n  ) {}\n\n  ngOnInit(): void {\n    this.user$ = this.auth.isUserLoggedIn().pipe(\n      switchMap((isUserLoggedIn) => {\n        if (isUserLoggedIn) {\n          return this.userAccount.get();\n        } else {\n          return of(undefined);\n        }\n      })\n    );\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport {\n  CmsConfig,\n  I18nModule,\n  provideDefaultConfig,\n  UrlModule,\n} from '@spartacus/core';\nimport { PageSlotModule } from '@spartacus/storefront';\nimport { LoginComponent } from './login.component';\n\n@NgModule({\n  imports: [CommonModule, RouterModule, UrlModule, PageSlotModule, I18nModule],\n  providers: [\n    provideDefaultConfig(<CmsConfig>{\n      cmsComponents: {\n        LoginComponent: {\n          component: LoginComponent,\n        },\n      },\n    }),\n  ],\n  declarations: [LoginComponent],\n})\nexport class LoginModule {}\n","import { NgModule } from '@angular/core';\nimport { LoginFormModule } from './login-form/login-form.module';\nimport { LoginRegisterModule } from './login-register/login-register.module';\nimport { LoginModule } from './login/login.module';\n\n@NgModule({\n  imports: [LoginModule, LoginFormModule, LoginRegisterModule],\n})\nexport class UserAccountComponentsModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}
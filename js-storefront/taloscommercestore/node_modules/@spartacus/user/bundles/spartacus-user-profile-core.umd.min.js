!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@spartacus/core"),require("rxjs/operators"),require("@spartacus/user/account/root"),require("@ngrx/store"),require("@spartacus/user/profile/root")):"function"==typeof define&&define.amd?define("@spartacus/user/profile/core",["exports","@angular/core","@spartacus/core","rxjs/operators","@spartacus/user/account/root","@ngrx/store","@spartacus/user/profile/root"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).spartacus=e.spartacus||{},e.spartacus.user=e.spartacus.user||{},e.spartacus.user.profile=e.spartacus.user.profile||{},e.spartacus.user.profile.core={}),e.ng.core,e.core,e.rxjs.operators,e.spartacus.user.account.root,e.store,e.spartacus.user.profile.root)}(this,(function(e,r,t,o,s,n,i){"use strict";var u=new r.InjectionToken("UserProfileNormalizer"),a=new r.InjectionToken("UserProfileSerializer"),c=new r.InjectionToken("UserSerializer"),p=new r.InjectionToken("UserSignUpSerializer"),d=new r.InjectionToken("TitleNormalizer"),f=function(){},l=function(){function e(e){this.userProfileAdapter=e}return e.prototype.update=function(e,r){return this.userProfileAdapter.update(e,r)},e.prototype.register=function(e){return this.userProfileAdapter.register(e)},e.prototype.registerGuest=function(e,r){return this.userProfileAdapter.registerGuest(e,r)},e.prototype.requestForgotPasswordEmail=function(e){return this.userProfileAdapter.requestForgotPasswordEmail(e)},e.prototype.resetPassword=function(e,r){return this.userProfileAdapter.resetPassword(e,r)},e.prototype.updateEmail=function(e,r,t){return this.userProfileAdapter.updateEmail(e,r,t)},e.prototype.updatePassword=function(e,r,t){return this.userProfileAdapter.updatePassword(e,r,t)},e.prototype.remove=function(e){return this.userProfileAdapter.close(e)},e.prototype.getTitles=function(){return this.userProfileAdapter.loadTitles()},e}();l.decorators=[{type:r.Injectable}],l.ctorParameters=function(){return[{type:f}]};var m=function(){function e(e,r,s){var n=this;this.userIdService=e,this.userProfileConnector=r,this.command=s,this.updateCommand=this.command.create((function(e){return n.userIdService.takeUserId(!0).pipe(o.switchMap((function(r){return n.userProfileConnector.updateEmail(r,e.password,e.newUid)})))}),{strategy:t.CommandStrategy.Queue})}return e.prototype.update=function(e,r){return this.updateCommand.execute({password:e,newUid:r})},e}();m.decorators=[{type:r.Injectable}],m.ctorParameters=function(){return[{type:t.UserIdService},{type:l},{type:t.CommandService}]};var h=function(){function e(e,r,t){var s=this;this.userProfileConnector=e,this.userIdService=r,this.command=t,this.updateCommand=this.command.create((function(e){return s.userIdService.takeUserId(!0).pipe(o.take(1),o.switchMap((function(r){return s.userProfileConnector.updatePassword(r,e.oldPassword,e.newPassword)})))})),this.resetCommand=this.command.create((function(e){return s.userProfileConnector.resetPassword(e.token,e.password)})),this.requestForgotPasswordEmailCommand=this.command.create((function(e){return s.userProfileConnector.requestForgotPasswordEmail(e.email)}))}return e.prototype.update=function(e,r){return this.updateCommand.execute({oldPassword:e,newPassword:r})},e.prototype.reset=function(e,r){return this.resetCommand.execute({token:e,password:r})},e.prototype.requestForgotPasswordEmail=function(e){return this.requestForgotPasswordEmailCommand.execute({email:e})},e}();h.decorators=[{type:r.Injectable}],h.ctorParameters=function(){return[{type:l},{type:t.UserIdService},{type:t.CommandService}]};var y=function(){function e(e,r,n,i,u,a,c){var p=this;this.userAccountService=e,this.authService=r,this.userProfileConnector=n,this.eventService=i,this.userIdService=u,this.query=a,this.command=c,this.updateCommand=this.command.create((function(e){return p.userIdService.takeUserId(!0).pipe(o.switchMap((function(r){return p.userProfileConnector.update(r,e.details).pipe(o.tap((function(){p.eventService.dispatch({user:e.details},s.UserAccountChangedEvent)})))})))}),{strategy:t.CommandStrategy.Queue}),this.closeCommand=this.command.create((function(){return p.userIdService.takeUserId(!0).pipe(o.switchMap((function(e){return p.userProfileConnector.remove(e).pipe(o.tap((function(){return p.authService.logout()})))})))})),this.titleQuery=this.query.create((function(){return p.userProfileConnector.getTitles()}),{reloadOn:[t.LanguageSetEvent]})}return e.prototype.get=function(){return this.userAccountService.get()},e.prototype.update=function(e){return this.updateCommand.execute({details:e})},e.prototype.close=function(){return this.closeCommand.execute(void 0)},e.prototype.getTitles=function(){return this.titleQuery.get().pipe(o.map((function(e){return null!=e?e:[]})))},e}();y.decorators=[{type:r.Injectable}],y.ctorParameters=function(){return[{type:s.UserAccountFacade},{type:t.AuthService},{type:l},{type:t.EventService},{type:t.UserIdService},{type:t.QueryService},{type:t.CommandService}]};var v=function(){function e(e,r,s,n,i){var u=this;this.userProfile=e,this.userConnector=r,this.authService=s,this.command=n,this.store=i,this.registerCommand=this.command.create((function(e){var r=e.user;return u.userConnector.register(r).pipe(o.tap((function(){u.store.dispatch(new t.UserActions.RegisterUserSuccess)})))})),this.registerGuestCommand=this.command.create((function(e){return u.userConnector.registerGuest(e.guid,e.password).pipe(o.tap((function(r){u.authService.loginWithCredentials(r.uid,e.password)})))}))}return e.prototype.register=function(e){return this.registerCommand.execute({user:e})},e.prototype.registerGuest=function(e,r){return this.registerGuestCommand.execute({guid:e,password:r})},e.prototype.getTitles=function(){return this.userProfile.getTitles()},e}();v.decorators=[{type:r.Injectable}],v.ctorParameters=function(){return[{type:y},{type:l},{type:t.AuthService},{type:t.CommandService},{type:n.Store}]};Object.create;function P(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,s,n=t.call(e),i=[];try{for(;(void 0===r||r-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(e){s={error:e}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return i}Object.create;var g=[m,h,y,v,{provide:i.UserEmailFacade,useExisting:m},{provide:i.UserPasswordFacade,useExisting:h},{provide:i.UserProfileFacade,useExisting:y},{provide:i.UserRegisterFacade,useExisting:v}],S=function(){};S.decorators=[{type:r.NgModule,args:[{providers:function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(P(arguments[r]));return e}([l],g)}]}],e.TITLE_NORMALIZER=d,e.USER_PROFILE_NORMALIZER=u,e.USER_PROFILE_SERIALIZER=a,e.USER_SERIALIZER=c,e.USER_SIGN_UP_SERIALIZER=p,e.UserEmailService=m,e.UserPasswordService=h,e.UserProfileAdapter=f,e.UserProfileConnector=l,e.UserProfileCoreModule=S,e.UserProfileService=y,e.UserRegisterService=v,e.Éµa=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=spartacus-user-profile-core.umd.min.js.map